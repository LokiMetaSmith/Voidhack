{"file_contents":{"replit.md":{"content":"# USS Enterprise Computer Interface\n\n## Project Overview\nA voice-interactive web application that emulates the iconic Star Trek Enterprise Computer. Users can speak naturally to an AI-powered computer that responds with authentic Star Trek-style dialogue and information.\n\n## Current State\n**Status**: ✅ Fully functional MVP complete\n- Voice input/output working via Web Speech API\n- Gemini AI integration operational with Enterprise Computer personality\n- LCARS-inspired UI design implemented\n- Mobile-responsive layout complete\n- Conversation context and history working\n\n## Recent Changes\n\n### December 1, 2025 - AirPods Hardware Tap Gesture (Not Supported - iOS Limitation)\n- **Attempted AirPod tap gesture support**: Investigated using Media Session API to capture AirPod/Bluetooth hardware button events\n- **Conclusion**: **NOT POSSIBLE on iOS Safari** due to WebKit limitations\n- **Root cause**: iOS Safari only forwards Bluetooth hardware button events to web pages when the page is actively playing audible audio (like music). Silent audio tracks are ignored by iOS, and AirPod taps are handled at the OS level instead of being sent to the web app.\n- **Apple's intentional design**: This is a security/UX decision - Apple prevents web pages from hijacking Bluetooth headphone controls unless actively playing audio content.\n- **Alternative required**: To support AirPod tap gestures, a native iOS app wrapper (using Capacitor, React Native, or Swift) would be needed to access Apple's `MPRemoteCommandCenter` API.\n- **Current solution**: Users must tap the on-screen microphone button to activate voice input on mobile devices. UI updated to clarify this limitation.\n\n### November 30, 2025 - Bluetooth/AirPods Microphone Support (Complete)\n- **Added Bluetooth and AirPods microphone support for mobile devices**: When users tap the microphone button with connected Bluetooth audio devices (AirPods, headsets), the app now properly routes audio input through those devices\n- **Implementation**:\n  - Added `initializeBluetoothAudio()` function in `useSpeechRecognition.ts`\n  - Uses `navigator.mediaDevices.getUserMedia()` to \"prime\" the audio subsystem before starting speech recognition\n  - Audio constraints include `echoCancellation`, `noiseSuppression`, and `autoGainControl` for better Bluetooth audio quality\n  - The MediaStream is immediately stopped after initialization - it only serves to establish the audio route\n  - Only activated on mobile devices (iOS/Android) where Bluetooth routing is needed\n- **Logging**: Console logs show which audio device was selected, helping debug Bluetooth connectivity issues\n- **Result**: Users can now speak through their AirPods or Bluetooth headsets on both iPhone and Android devices\n\n### November 27, 2025 - Cross-Platform Voice Consistency (Complete)\n- **Unified female computer voice across iOS, Android, and desktop**: Implemented consistent Star Trek computer voice selection using prioritized voice list\n- **Voice priority order**: Zira (Windows), Samantha/Ava (iOS/macOS), Google UK/US English Female (Chrome/Android), generic female voices as fallback\n- **Speech rate optimized**: Changed default rate from 1.0 to 0.9 for more deliberate, computer-like cadence\n- **Implementation**:\n  - Added `PREFERRED_VOICE_NAMES` constant with platform-appropriate female voices\n  - Voice selection iterates through priority list, selects first available match\n  - Filters to English voices first for reliability\n  - Consistent voice selection logic in both `useSpeechSynthesis.ts` and `VoiceSettings.tsx`\n- **Result**: All platforms now use a calm, professional female voice resembling the USS Enterprise computer\n\n### November 27, 2025 - iOS Safari Voice Input & Output Fix (Complete)\n- **Fixed iPhone voice input and output issues**: Resolved issues where (1) mic button captured voice but app didn't process it, and (2) AI responses were not being spoken on iOS Safari\n- **Root causes identified**:\n  - **Speech Recognition (Input)**: iOS Safari's `continuous: true` mode has unreliable `isFinal` flags; transcript processing depended on `voiceState` which could be reset before processing\n  - **Speech Synthesis (Output)**: iOS Safari requires speech synthesis to be initiated from a user gesture context; by the time the API response arrived, the gesture context was lost\n- **Solution implemented for Speech Recognition**:\n  - Added `isIOSDevice()` detection function to identify iPhone/iPad/iPod\n  - Set `recognition.continuous = false` for iOS (desktop/Android retain `continuous: true`)\n  - Added iOS-specific 1.5-second silence detection timeout\n  - Removed `voiceState` dependency from transcript processing\n  - Added `isProcessingTranscriptRef` guard to prevent duplicate sends\n- **Solution implemented for Speech Synthesis**:\n  - Added `warmUp()` function that speaks a silent utterance to \"unlock\" iOS speech synthesis\n  - `warmUp()` is called during user gestures (mic tap, hands-free toggle)\n  - `speak()` auto-triggers warmup on iOS if not warmed up, queuing text until ready\n  - Used `doSpeakRef` pattern to avoid React hook ordering issues\n  - Pending text queue ensures responses are always spoken after warmup completes\n- **Result**: iOS users now have reliable voice input AND output. The complete flow works: tap mic → speak → AI processes → computer responds with voice\n- **Technical note**: These are Safari WebKit bugs that have persisted since iOS 15.1. Both fixes follow documented workarounds for Safari's Web Speech API limitations\n\n### November 9, 2025 - Android Production Voice Solution: Manual Mode Only\n- **Disabled continuous voice mode on Android production**: After extensive debugging of microphone \"aborted\" errors, implemented architectural solution to disable Voice Activity Detection (VAD) on mobile devices in production\n- **Root cause analysis**: Android Chrome has strict OS-level microphone resource management that causes conflicts when VAD and Speech Recognition attempt sequential access, even with delays up to 600ms\n- **Final solution implemented**:\n  - Added `isContinuousModeAvailable()` helper to detect platform and environment\n  - Disabled continuous (hands-free) mode entirely on mobile production builds\n  - Manual mic mode (tap-to-speak) works reliably on all platforms including Android\n  - Updated UI to show \"Tap to speak (manual mode)\" on mobile devices\n  - Added user-friendly toast message if user attempts to enable continuous mode on mobile\n  - Preserved all continuous mode functionality for desktop browsers\n- **Result**: Android users now have a reliable voice input experience using manual mic mode. Desktop users retain full hands-free functionality. No more \"aborted\" errors or microphone conflicts.\n- **Mobile Limitation**: Continuous voice mode is not available on mobile devices in production. Users must tap the microphone button each time they want to speak. This is a platform limitation due to Android's strict microphone resource management.\n\n### October 26, 2025 - Android Manual Voice Input Fix\n- **Fixed Android manual mic button issue**: Resolved issue where clicking the \"ready\" button turned it green but the computer didn't respond to voice input\n- **Root cause**: Android browsers often fail to send final speech recognition results when using `continuous: true` mode, only sending interim results\n- **Solution implemented**:\n  - Process interim results immediately when recognition ends (onend event) on mobile devices\n  - Process interim results on error (except aborted) to capture speech even in error scenarios\n  - Added 2-second timeout as backup for cases where recognition doesn't auto-stop\n  - stopListening() preserves interim results for onend to process (critical for manual stop)\n  - Comprehensive logging to track interim result handling throughout the flow\n- **Result**: Both manual and hands-free voice input now work correctly on Android devices in all scenarios (auto-stop, manual stop, error conditions)\n\n### October 13, 2025 - Critical Android Hands-Free Fix\n- **Fixed Android stuck green mic issue**: Resolved critical state management bug where hands-free mode showed green mic but didn't capture voice on Android browsers\n- **Root cause**: Speech Recognition `isListening` state was being set optimistically before `onstart` event, creating invalid state when Android microphone handoff failed silently\n- **Solution implemented**:\n  - `isListening` state now ONLY set in `onstart` event handler (confirmed recognition actually started)\n  - Added 2-second startup timeout to detect Android silent failures\n  - Increased microphone handoff delay from 100ms to 300ms for Android resource release\n  - Comprehensive timeout cleanup in all exit paths\n- **Result**: Hands-free mode now properly detects voice, captures transcript, and processes on Android Chrome\n\n### October 10, 2025\n- Implemented complete Star Trek communicator application\n- Created LCARS-inspired UI with authentic Trek aesthetics (orange, blue, purple accents)\n- Integrated Gemini 2.5 Flash with custom Enterprise Computer system prompt\n- Built voice interaction system using Web Speech API\n- Added conversation history with context preservation\n- Fixed Gemini API response handling to properly extract text\n- Implemented defensive error handling for edge cases\n\n## Project Architecture\n\n### Frontend (`client/`)\n- **Framework**: React with TypeScript\n- **Routing**: Wouter (single page: Communicator)\n- **Styling**: Tailwind CSS with LCARS design tokens\n- **State Management**: React Query for API calls\n- **Voice Input**: Web Speech Recognition API\n- **Voice Output**: Web Speech Synthesis API\n\n### Backend (`server/`)\n- **Framework**: Express.js\n- **AI Integration**: Google Gemini 2.5 Flash\n- **API Routes**: `/api/chat` for conversation processing\n\n### Key Components\n1. **VoiceControlPanel**: Main communicator button with audio visualization\n2. **ConversationDisplay**: Message history with role-based styling\n3. **LCARSHeader**: Star Trek styled header with branding\n4. **StatusIndicator**: Visual state indicators (Ready/Listening/Processing/Speaking)\n5. **useSpeechRecognition**: Custom hook for voice input\n6. **useSpeechSynthesis**: Custom hook for voice output\n\n### Data Schema\n```typescript\nConversationMessage {\n  id: string\n  role: \"user\" | \"computer\"\n  text: string\n  timestamp: number\n}\n```\n\n## User Preferences\n- Authentic Star Trek LCARS design aesthetic\n- Voice-first interaction model\n- Mobile-responsive experience\n- Professional, computer-like AI responses\n\n## Technical Details\n\n### Environment Variables\n- `GEMINI_API_KEY`: Required for AI responses\n- `SESSION_SECRET`: For session management\n\n### API Endpoints\n- `POST /api/chat`: Send user message, receive computer response\n  - Request: `{ message: string, conversationHistory?: ConversationMessage[] }`\n  - Response: `{ message: string, messageId: string }`\n\n### Design System\n- **Primary Orange**: 25 100% 70% (LCARS signature color)\n- **Secondary Blue**: 235 60% 75%\n- **Accent Purple**: 290 40% 70%\n- **Success Green**: 145 85% 60% (listening state)\n- **Warning Yellow**: 45 100% 65% (processing state)\n\n### Voice States\n1. **Idle**: Ready for input\n2. **Listening**: Capturing user speech\n3. **Processing**: Sending to Gemini AI\n4. **Speaking**: Computer responding with TTS\n\n## Testing Notes\n- API tested successfully with conversation context\n- Gemini integration returns authentic Enterprise Computer responses\n- Voice synthesis configured for computer-like voice (female, moderate pace)\n- Responsive design works across mobile and desktop viewports\n\n## Known Limitations\n- Web Speech API browser compatibility (works best in Chrome/Edge)\n- Speech recognition requires microphone permissions\n- Text-to-speech voices vary by platform/browser\n\n## Next Steps / Future Enhancements\n- Voice activity detection for hands-free operation\n- Conversation persistence across sessions\n- Custom voice selection UI\n- Star Trek sound effects library\n- Enterprise systems status simulation\n- Dark mode toggle (currently dark by default)\n","path":null,"size_bytes":12045,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7609,"size_tokens":null},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { z } from \"zod\";\nimport { chatRequestSchema, conversationMessageSchema } from \"@shared/schema\";\nimport { generateComputerResponse } from \"./gemini\";\nimport { storage } from \"./storage\";\nimport { randomUUID } from \"crypto\";\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // Chat endpoint for Enterprise Computer\n  app.post(\"/api/chat\", async (req, res) => {\n    try {\n      // Validate request body\n      const validatedData = chatRequestSchema.parse(req.body);\n\n      // Get or create conversation\n      let conversationId = validatedData.conversationId;\n      if (!conversationId) {\n        const newConversation = await storage.createConversation();\n        conversationId = newConversation.id;\n      }\n\n      // Get conversation history from database if not provided\n      let conversationHistory = validatedData.conversationHistory || [];\n      if (!validatedData.conversationHistory && conversationId) {\n        const dbMessages = await storage.getConversationMessages(conversationId);\n        conversationHistory = dbMessages.map(msg => ({\n          id: msg.id,\n          role: msg.role as \"user\" | \"computer\",\n          text: msg.text,\n          timestamp: msg.timestamp,\n        }));\n      }\n\n      // Save user message\n      const userMessage = await storage.createMessage({\n        conversationId,\n        role: \"user\",\n        text: validatedData.message,\n        timestamp: Date.now(),\n      });\n\n      // Generate response from Gemini\n      const computerResponse = await generateComputerResponse(\n        validatedData.message,\n        conversationHistory,\n        validatedData.shipSystems\n      );\n\n      // Save computer response\n      const computerMessage = await storage.createMessage({\n        conversationId,\n        role: \"computer\",\n        text: computerResponse,\n        timestamp: Date.now(),\n      });\n\n      res.json({\n        message: computerResponse,\n        messageId: computerMessage.id,\n        conversationId,\n      });\n    } catch (error) {\n      console.error(\"Chat error:\", error);\n      \n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: \"Invalid request data\" });\n      }\n\n      res.status(500).json({ \n        error: error instanceof Error ? error.message : \"Internal server error\" \n      });\n    }\n  });\n\n  // Get conversation history\n  app.get(\"/api/conversations/:id/messages\", async (req, res) => {\n    try {\n      const conversationId = req.params.id;\n      const messages = await storage.getConversationMessages(conversationId);\n      \n      res.json({\n        messages: messages.map(msg => ({\n          id: msg.id,\n          role: msg.role,\n          text: msg.text,\n          timestamp: msg.timestamp,\n        })),\n      });\n    } catch (error) {\n      console.error(\"Get messages error:\", error);\n      res.status(500).json({ \n        error: error instanceof Error ? error.message : \"Internal server error\" \n      });\n    }\n  });\n\n  // Delete conversation\n  app.delete(\"/api/conversations/:id\", async (req, res) => {\n    try {\n      const conversationId = req.params.id;\n      await storage.deleteConversation(conversationId);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Delete conversation error:\", error);\n      res.status(500).json({ \n        error: error instanceof Error ? error.message : \"Internal server error\" \n      });\n    }\n  });\n\n  const httpServer = createServer(app);\n\n  return httpServer;\n}\n","path":null,"size_bytes":3551,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1251,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4281,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4420,"size_tokens":null},"client/src/hooks/useVoiceActivityDetection.ts":{"content":"import { useState, useEffect, useCallback, useRef } from \"react\";\n\ninterface VoiceActivityDetectionResult {\n  isVoiceDetected: boolean;\n  audioLevel: number;\n  startDetection: () => void;\n  stopDetection: () => void;\n  permissionState: 'unknown' | 'checking' | 'granted' | 'denied' | 'error';\n  error: string | null;\n}\n\nconst isMobileDevice = () => {\n  return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\n};\n\nconst checkMicrophonePermission = async (): Promise<'granted' | 'denied' | 'prompt' | 'unsupported'> => {\n  try {\n    if (!navigator.permissions) {\n      console.log(\"[VAD] Permissions API not supported\");\n      return 'unsupported';\n    }\n    \n    const result = await navigator.permissions.query({ name: 'microphone' as PermissionName });\n    console.log(\"[VAD] Permission status:\", result.state);\n    return result.state as 'granted' | 'denied' | 'prompt';\n  } catch (error) {\n    console.warn(\"[VAD] Error checking microphone permission:\", error);\n    return 'unsupported';\n  }\n};\n\nexport function useVoiceActivityDetection(\n  threshold: number = 0.01,\n  onVoiceStart?: () => void,\n  onVoiceEnd?: () => void,\n  onError?: (error: string) => void\n): VoiceActivityDetectionResult {\n  const [isVoiceDetected, setIsVoiceDetected] = useState(false);\n  const [audioLevel, setAudioLevel] = useState(0);\n  const [isDetecting, setIsDetecting] = useState(false);\n  const [permissionState, setPermissionState] = useState<'unknown' | 'checking' | 'granted' | 'denied' | 'error'>('unknown');\n  const [error, setError] = useState<string | null>(null);\n  const isStoppingRef = useRef(false);\n  const isStartingRef = useRef(false); // Prevents concurrent start attempts\n  \n  const audioContextRef = useRef<AudioContext | null>(null);\n  const analyserRef = useRef<AnalyserNode | null>(null);\n  const microphoneRef = useRef<MediaStreamAudioSourceNode | null>(null);\n  const animationFrameRef = useRef<number | null>(null);\n  const streamRef = useRef<MediaStream | null>(null);\n  const voiceTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n\n  const detectVoice = useCallback(() => {\n    if (!analyserRef.current) return;\n\n    const dataArray = new Uint8Array(analyserRef.current.frequencyBinCount);\n    analyserRef.current.getByteFrequencyData(dataArray);\n\n    // Calculate average volume\n    const average = dataArray.reduce((sum, value) => sum + value, 0) / dataArray.length;\n    const normalizedLevel = average / 255;\n    setAudioLevel(normalizedLevel);\n\n    // Detect voice activity\n    if (normalizedLevel > threshold) {\n      if (!isVoiceDetected) {\n        console.log(\"[VAD] Voice detected!\", { level: normalizedLevel, threshold });\n        setIsVoiceDetected(true);\n        onVoiceStart?.();\n      }\n      \n      // Reset voice end timeout\n      if (voiceTimeoutRef.current) {\n        clearTimeout(voiceTimeoutRef.current);\n      }\n      \n      // Set timeout to detect when voice stops\n      voiceTimeoutRef.current = setTimeout(() => {\n        console.log(\"[VAD] Voice ended (1500ms silence)\");\n        setIsVoiceDetected(false);\n        onVoiceEnd?.();\n      }, 1500);\n    }\n\n    animationFrameRef.current = requestAnimationFrame(detectVoice);\n  }, [threshold, isVoiceDetected, onVoiceStart, onVoiceEnd]);\n\n  const startDetection = useCallback(async () => {\n    const isMobile = isMobileDevice();\n    const isProduction = import.meta.env.PROD;\n    \n    console.log(\"[VAD] startDetection called\", { \n      isDetecting, \n      isStarting: isStartingRef.current,\n      isStopping: isStoppingRef.current,\n      hasStream: !!streamRef.current,\n      currentPermissionState: permissionState,\n      isMobile,\n      isProduction,\n      userAgent: navigator.userAgent \n    });\n    \n    // CRITICAL FIX: Wait for any ongoing stop to complete before starting\n    if (isStoppingRef.current) {\n      console.log(\"[VAD] Stop in progress, waiting for completion before starting\");\n      await new Promise(resolve => {\n        const checkInterval = setInterval(() => {\n          if (!isStoppingRef.current) {\n            clearInterval(checkInterval);\n            resolve(undefined);\n          }\n        }, 50);\n        // Timeout after 2 seconds to prevent infinite wait\n        setTimeout(() => {\n          clearInterval(checkInterval);\n          resolve(undefined);\n        }, 2000);\n      });\n    }\n    \n    // Guard: Prevent concurrent start attempts\n    if (isDetecting || isStartingRef.current) {\n      console.log(\"[VAD] Already detecting or starting, skipping start\");\n      return;\n    }\n    \n    // Set starting flag immediately to prevent concurrent calls\n    isStartingRef.current = true;\n    setError(null);\n    \n    // Only set to 'checking' if we don't already have permission granted\n    if (permissionState !== 'granted') {\n      setPermissionState('checking');\n    }\n    \n    try {\n      // Check permission status only if not already granted\n      if (permissionState !== 'granted') {\n        const permissionStatus = await checkMicrophonePermission();\n        console.log(\"[VAD] Permission check result:\", permissionStatus);\n        \n        if (permissionStatus === 'denied') {\n          const errorMsg = isMobile \n            ? \"Microphone access denied. Please enable microphone in browser settings.\"\n            : \"Microphone access denied. Please allow microphone access to use voice features.\";\n          console.error(\"[VAD] Permission denied before getUserMedia\");\n          setPermissionState('denied');\n          setError(errorMsg);\n          onError?.(errorMsg);\n          return;\n        }\n      }\n      \n      // Guard: If stream exists, clean it up first (simplified cleanup)\n      if (streamRef.current) {\n        console.log(\"[VAD] Stream already exists, cleaning up before restart\");\n        const tracks = streamRef.current.getTracks();\n        tracks.forEach(track => track.stop());\n        streamRef.current = null;\n        \n        // Android needs more time to fully release microphone resources in production\n        const cleanupDelay = isMobile && isProduction ? 300 : 100;\n        console.log(`[VAD] Waiting ${cleanupDelay}ms for cleanup to complete`);\n        await new Promise(resolve => setTimeout(resolve, cleanupDelay));\n      }\n      \n      console.log(\"[VAD] Requesting microphone access...\");\n      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n      console.log(\"[VAD] Microphone access granted\", { \n        streamId: stream.id,\n        audioTracks: stream.getAudioTracks().length \n      });\n      streamRef.current = stream;\n      setPermissionState('granted');\n\n      const audioContext = new AudioContext();\n      const analyser = audioContext.createAnalyser();\n      analyser.fftSize = 512;\n      analyser.smoothingTimeConstant = 0.8;\n\n      const microphone = audioContext.createMediaStreamSource(stream);\n      microphone.connect(analyser);\n\n      audioContextRef.current = audioContext;\n      analyserRef.current = analyser;\n      microphoneRef.current = microphone;\n\n      setIsDetecting(true);\n      console.log(\"[VAD] Detection started successfully\");\n      detectVoice();\n    } catch (error: any) {\n      const errorName = error?.name || 'Unknown';\n      const errorMessage = error?.message || 'Unknown error';\n      \n      console.error(\"[VAD] Error starting voice detection:\", {\n        error,\n        errorName,\n        errorMessage,\n        isMobile,\n        isProduction\n      });\n      \n      let userFriendlyError = \"Failed to access microphone.\";\n      \n      if (errorName === 'NotAllowedError' || errorName === 'PermissionDeniedError') {\n        userFriendlyError = isMobile\n          ? \"Microphone access denied. Tap your browser's settings icon and enable microphone permissions for this site.\"\n          : \"Microphone access denied. Please allow microphone access when prompted.\";\n        setPermissionState('denied');\n      } else if (errorName === 'NotFoundError' || errorName === 'DevicesNotFoundError') {\n        userFriendlyError = \"No microphone found. Please connect a microphone and try again.\";\n        setPermissionState('error');\n      } else if (errorName === 'NotReadableError' || errorName === 'TrackStartError') {\n        userFriendlyError = isMobile\n          ? \"Microphone is busy. Close other apps using the microphone and try again.\"\n          : \"Microphone is already in use by another application.\";\n        setPermissionState('error');\n      } else {\n        userFriendlyError = `Microphone error: ${errorMessage}`;\n        setPermissionState('error');\n      }\n      \n      setError(userFriendlyError);\n      onError?.(userFriendlyError);\n    } finally {\n      // Clear starting flag when done (success or error)\n      isStartingRef.current = false;\n    }\n  }, [detectVoice, isDetecting, permissionState, onError]);\n\n  const stopDetection = useCallback(async () => {\n    console.log(\"[VAD] stopDetection called\", { \n      isDetecting, \n      isStopping: isStoppingRef.current \n    });\n    \n    // Guard: prevent multiple stops\n    if (!isDetecting || isStoppingRef.current) {\n      console.log(\"[VAD] Skipping stop - already stopped or stopping\");\n      return;\n    }\n    isStoppingRef.current = true;\n    \n    // Cancel animation frame\n    if (animationFrameRef.current) {\n      cancelAnimationFrame(animationFrameRef.current);\n      animationFrameRef.current = null;\n    }\n\n    // Clear timeout\n    if (voiceTimeoutRef.current) {\n      clearTimeout(voiceTimeoutRef.current);\n      voiceTimeoutRef.current = null;\n    }\n\n    // Disconnect microphone\n    if (microphoneRef.current) {\n      microphoneRef.current.disconnect();\n      microphoneRef.current = null;\n    }\n\n    // Close AudioContext only if it exists and isn't already closed\n    if (audioContextRef.current?.state !== 'closed') {\n      try {\n        await audioContextRef.current?.close();\n        console.log(\"[VAD] AudioContext closed successfully\");\n      } catch (err) {\n        console.warn(\"[VAD] Error closing AudioContext:\", err);\n      }\n    }\n    audioContextRef.current = null;\n\n    // Stop media stream tracks synchronously (no requestAnimationFrame needed)\n    if (streamRef.current) {\n      const tracks = streamRef.current.getTracks();\n      console.log(\"[VAD] Stopping media stream tracks\", { trackCount: tracks.length });\n      tracks.forEach(track => track.stop());\n      streamRef.current = null;\n    }\n\n    setIsDetecting(false);\n    setIsVoiceDetected(false);\n    setAudioLevel(0);\n    // CRITICAL FIX: Don't reset permission state - preserve it for UI consistency\n    // Permission state only changes when explicitly checking or on errors\n    isStoppingRef.current = false;\n    console.log(\"[VAD] Detection stopped successfully\");\n  }, [isDetecting]);\n\n  useEffect(() => {\n    return () => {\n      stopDetection();\n    };\n  }, [stopDetection]);\n\n  return {\n    isVoiceDetected,\n    audioLevel,\n    startDetection,\n    stopDetection,\n    permissionState,\n    error,\n  };\n}\n","path":null,"size_bytes":10924,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2765,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10481,"size_tokens":null},"client/src/components/StatusIndicator.tsx":{"content":"import { VoiceState } from \"@shared/schema\";\n\ninterface StatusIndicatorProps {\n  state: VoiceState;\n}\n\nexport function StatusIndicator({ state }: StatusIndicatorProps) {\n  const getStatusConfig = () => {\n    switch (state) {\n      case \"listening\":\n        return {\n          color: \"bg-chart-4\",\n          label: \"ACTIVE\",\n          pulse: true,\n        };\n      case \"processing\":\n        return {\n          color: \"bg-chart-5\",\n          label: \"PROCESSING\",\n          pulse: true,\n        };\n      case \"speaking\":\n        return {\n          color: \"bg-chart-2\",\n          label: \"TRANSMITTING\",\n          pulse: true,\n        };\n      default:\n        return {\n          color: \"bg-primary\",\n          label: \"STANDBY\",\n          pulse: false,\n        };\n    }\n  };\n\n  const config = getStatusConfig();\n\n  return (\n    <div className=\"flex items-center gap-3\" data-testid=\"status-indicator\">\n      <div className=\"relative\">\n        <div\n          className={`h-3 w-3 rounded-full ${config.color} ${\n            config.pulse ? \"animate-pulse\" : \"\"\n          }`}\n        />\n        {config.pulse && (\n          <div\n            className={`absolute inset-0 h-3 w-3 rounded-full ${config.color} opacity-50 animate-pulse`}\n          />\n        )}\n      </div>\n      <span className=\"text-xs font-medium tracking-wider uppercase text-muted-foreground\">\n        {config.label}\n      </span>\n    </div>\n  );\n}\n","path":null,"size_bytes":1409,"size_tokens":null},"design_guidelines.md":{"content":"# Star Trek Enterprise Computer Communicator - Design Guidelines\n\n## Design Approach: Reference-Based (Star Trek LCARS Interface)\n\n**Primary Inspiration**: Star Trek's LCARS (Library Computer Access/Retrieval System) - the iconic interface used throughout Star Trek: The Next Generation and subsequent series.\n\n**Design Philosophy**: Create an immersive, authentic Star Trek experience with the signature LCARS aesthetic - bold geometric shapes, vibrant accent colors on dark backgrounds, and futuristic yet functional interface elements that make users feel like they're aboard the Enterprise.\n\n## Core Design Elements\n\n### A. Color Palette\n\n**Dark Mode Primary** (LCARS-inspired):\n- Background: 15 8% 8% (Deep space black)\n- Surface: 15 10% 12% (Panel dark)\n- Primary (LCARS Orange): 25 100% 70%\n- Secondary (LCARS Blue): 235 60% 75%\n- Accent (LCARS Purple): 290 40% 70%\n- Text Primary: 0 0% 95%\n- Text Secondary: 0 0% 70%\n- Success (Active): 145 85% 60%\n- Warning (Processing): 45 100% 65%\n\n### B. Typography\n\n**Font Stack**:\n- Primary: \"Inter\", \"Helvetica Neue\", system-ui, sans-serif\n- Monospace: \"JetBrains Mono\", \"Courier New\", monospace (for computer responses)\n\n**Type Scale**:\n- Hero/Display: text-4xl to text-6xl, font-bold, tracking-tight\n- Section Headers: text-2xl to text-3xl, font-semibold\n- Body: text-base to text-lg, font-normal\n- Labels/Metadata: text-sm, font-medium, uppercase, tracking-wide (LCARS style)\n- Code/Computer Text: text-sm to text-base, font-mono\n\n### C. Layout System\n\n**Spacing Primitives**: Use Tailwind units of 2, 4, 8, and 16 for consistent rhythm (p-4, m-8, gap-4, etc.)\n\n**Container Strategy**:\n- Mobile: Full width with px-4 padding\n- Desktop: max-w-4xl centered for main content\n- Voice interface: Fixed or sticky positioning for always-accessible controls\n\n**Grid System**: Single-column mobile, may expand to asymmetric LCARS-style panels on desktop (70/30 splits with angled dividers)\n\n### D. Component Library\n\n**1. Voice Control Panel** (Primary interaction zone):\n- Large circular push-to-talk button (LCARS orange when inactive, pulsing green when active)\n- Audio waveform visualization during voice input (animated bars in LCARS blue)\n- Status indicator labels: \"READY\", \"LISTENING\", \"PROCESSING\", \"SPEAKING\"\n- Geometric panel frame with rounded corners and angled edges\n\n**2. Conversation Display**:\n- Scrollable message list with clear user/computer distinction\n- User messages: Right-aligned, LCARS blue accent, sans-serif font\n- Computer responses: Left-aligned, LCARS orange accent, monospace font\n- Timestamp metadata in small uppercase labels\n- Segmented background panels (LCARS style) for each message group\n\n**3. Status Indicators**:\n- Connection status badge (top-right corner)\n- Processing spinner using LCARS geometric elements (not circular)\n- Audio level meter (horizontal bars during listening)\n- Visual feedback: Subtle glow effects on active elements\n\n**4. Navigation Header**:\n- \"USS ENTERPRISE - COMPUTER INTERFACE\" title in uppercase\n- LCARS-style horizontal bars framing the header\n- Minimal icons (settings, info) in top corners\n- Angled decorative elements\n\n**5. Control Buttons**:\n- Rounded rectangular shapes with slight angle\n- LCARS color coding (orange for primary actions, blue for secondary)\n- No borders, solid fills\n- Uppercase labels\n- Clear/End Conversation button in contrasting color\n\n### E. Animations\n\n**Minimal, Purposeful Animations**:\n- Microphone button: Gentle pulse during listening state (1.5s ease-in-out)\n- Waveform: Real-time audio visualization (reactive to input)\n- Message appearance: Subtle slide-in from appropriate side (200ms)\n- Processing indicator: Horizontal scanning bar (LCARS computer style)\n- NO hover animations - let native button states handle interaction\n\n## Mobile-First Responsive Strategy\n\n**Mobile (base)**: \n- Single-column stacked layout\n- Full-width voice control panel at bottom (sticky)\n- Conversation scrolls in middle\n- Header condensed with hamburger menu\n\n**Desktop (lg:)**:\n- LCARS asymmetric panel layout\n- Voice controls in left panel (30% width, fixed)\n- Conversation history in right panel (70% width)\n- Decorative LCARS elements in corners and edges\n\n## Images\n\n**No hero image needed**. This is a utility-focused voice interface app.\n\n**Optional Icon/Logo**: A small Starfleet delta insignia or Enterprise silhouette as a header badge (30-40px, subtle, monochrome white/orange)\n\n## Accessibility & Interaction\n\n- High contrast maintained (LCARS colors on dark backgrounds meet WCAA AA)\n- Large touch targets (minimum 48px) for voice controls\n- Clear visual state changes for all interaction modes\n- Screen reader labels for all functional elements\n- Keyboard navigation support (spacebar for push-to-talk)\n\n## Key Design Principles\n\n1. **Authenticity**: Faithful to LCARS aesthetic while remaining functional\n2. **Clarity**: User always knows system state (listening/processing/speaking)\n3. **Immersion**: Every element reinforces the Star Trek experience\n4. **Simplicity**: Despite visual richness, interaction remains straightforward\n5. **Responsiveness**: Seamless experience from phone to desktop","path":null,"size_bytes":5140,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","path":null,"size_bytes":157,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1467,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3848,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":2359,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4885,"size_tokens":null},"client/src/hooks/useSpeechSynthesis.ts":{"content":"import { useState, useCallback, useEffect, useRef } from \"react\";\n\nexport interface VoiceSettings {\n  voiceIndex?: number;\n  rate?: number;\n  pitch?: number;\n  volume?: number;\n}\n\n// Prioritized list of female voices that sound like Star Trek computer\n// These are calm, professional, clear female voices across platforms\nconst PREFERRED_VOICE_NAMES = [\n  // iOS/macOS - these are the most common female voices on Apple devices\n  \"samantha\",      // US English female - most common iOS default\n  \"ava\",           // US English female - premium voice\n  \"allison\",       // US English female\n  \"susan\",         // UK English female\n  \"kate\",          // UK English female\n  \"serena\",        // UK English female\n  \"emily\",         // UK English female\n  \"siri female\",   // Siri voice\n  \"siri_female\",\n  // Windows\n  \"zira\",\n  \"hazel\",\n  // Google Chrome voices\n  \"google uk english female\",\n  \"google us english female\",\n  // Other female voices across platforms\n  \"female\",\n  \"victoria\",\n  \"karen\",         // Australian English female\n  \"moira\",         // Irish English female\n  \"fiona\",         // Scottish English female\n  \"tessa\",         // South African English female\n  \"veena\",         // Indian English female\n];\n\n// Male voices to explicitly exclude (these should never be selected)\nconst MALE_VOICE_NAMES = [\n  \"aaron\",         // iOS US male\n  \"daniel\",        // iOS/macOS UK male\n  \"fred\",          // macOS male\n  \"alex\",          // macOS male\n  \"tom\",           // UK male\n  \"oliver\",        // UK male\n  \"gordon\",        // UK male\n  \"lee\",           // Australian male\n  \"rishi\",         // Indian male\n  \"david\",         // Windows male\n  \"mark\",          // Windows male\n  \"james\",         // male\n  \"george\",        // male\n  \"google uk english male\",\n  \"google us english male\",\n  \"male\",\n];\n\ninterface SpeechSynthesisResult {\n  speak: (text: string, settings?: VoiceSettings) => void;\n  isSpeaking: boolean;\n  cancel: () => void;\n  warmUp: () => void;\n}\n\nfunction isIOSDevice(): boolean {\n  if (typeof window === \"undefined\" || typeof navigator === \"undefined\") {\n    return false;\n  }\n  return /iPhone|iPad|iPod/i.test(navigator.userAgent);\n}\n\n// Check if a voice is male (should be excluded)\nfunction isMaleVoice(voice: SpeechSynthesisVoice): boolean {\n  const nameLower = voice.name.toLowerCase();\n  return MALE_VOICE_NAMES.some(maleName => nameLower.includes(maleName));\n}\n\n// Find a preferred English female voice from the available voices\nfunction findPreferredVoice(voices: SpeechSynthesisVoice[]): SpeechSynthesisVoice | null {\n  if (voices.length === 0) return null;\n  \n  const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);\n  \n  // Log all available voices for debugging (especially useful for iOS)\n  console.log(\"[SpeechSynthesis] All available voices:\", \n    voices.map(v => `${v.name} (${v.lang})`).join(\", \")\n  );\n  \n  // Filter to only English voices first\n  const englishVoices = voices.filter(voice => voice.lang.startsWith(\"en\"));\n  console.log(\"[SpeechSynthesis] English voices:\", \n    englishVoices.map(v => `${v.name} (${v.lang})`).join(\", \")\n  );\n  \n  // Filter OUT male voices\n  const femaleEnglishVoices = englishVoices.filter(voice => !isMaleVoice(voice));\n  console.log(\"[SpeechSynthesis] Female English voices (after excluding males):\", \n    femaleEnglishVoices.map(v => `${v.name} (${v.lang})`).join(\", \")\n  );\n  \n  const voicesToSearch = femaleEnglishVoices.length > 0 ? femaleEnglishVoices : englishVoices;\n  \n  // Search for preferred voices in priority order\n  for (const preferredName of PREFERRED_VOICE_NAMES) {\n    const matchedVoice = voicesToSearch.find(\n      voice => voice.name.toLowerCase().includes(preferredName)\n    );\n    if (matchedVoice) {\n      console.log(\"[SpeechSynthesis] Matched preferred voice:\", matchedVoice.name, \"for pattern:\", preferredName);\n      return matchedVoice;\n    }\n  }\n  \n  // Fallback: prefer any female English voice over male\n  if (femaleEnglishVoices.length > 0) {\n    console.log(\"[SpeechSynthesis] Using first female English voice as fallback:\", femaleEnglishVoices[0].name);\n    return femaleEnglishVoices[0];\n  }\n  \n  // Last resort: any English voice (even if male, at least it's English)\n  if (englishVoices.length > 0) {\n    console.warn(\"[SpeechSynthesis] No female voice found, using first English voice:\", englishVoices[0].name);\n    return englishVoices[0];\n  }\n  \n  console.warn(\"[SpeechSynthesis] No English voices found at all\");\n  return null;\n}\n\n// Poll for voices with timeout - iOS often delays voice loading\nfunction waitForPreferredVoice(\n  timeoutMs: number = 3000,\n  pollIntervalMs: number = 100\n): Promise<SpeechSynthesisVoice | null> {\n  return new Promise((resolve) => {\n    const startTime = Date.now();\n    \n    // Check immediately\n    const voices = window.speechSynthesis.getVoices();\n    const preferred = findPreferredVoice(voices);\n    if (preferred) {\n      console.log(\"[SpeechSynthesis] Found preferred voice immediately:\", preferred.name);\n      resolve(preferred);\n      return;\n    }\n    \n    // Set up polling\n    const pollInterval = setInterval(() => {\n      const voices = window.speechSynthesis.getVoices();\n      const preferred = findPreferredVoice(voices);\n      \n      if (preferred) {\n        console.log(\"[SpeechSynthesis] Found preferred voice after polling:\", preferred.name);\n        clearInterval(pollInterval);\n        resolve(preferred);\n        return;\n      }\n      \n      // Check timeout\n      if (Date.now() - startTime > timeoutMs) {\n        console.warn(\"[SpeechSynthesis] Timeout waiting for preferred voice, voices available:\", voices.length);\n        clearInterval(pollInterval);\n        // Return any English voice or null\n        const englishVoice = voices.find(v => v.lang.startsWith(\"en\"));\n        resolve(englishVoice || null);\n      }\n    }, pollIntervalMs);\n    \n    // Also listen for voiceschanged event\n    const onVoicesChanged = () => {\n      const voices = window.speechSynthesis.getVoices();\n      const preferred = findPreferredVoice(voices);\n      if (preferred) {\n        console.log(\"[SpeechSynthesis] Found preferred voice via voiceschanged:\", preferred.name);\n        clearInterval(pollInterval);\n        window.speechSynthesis.removeEventListener(\"voiceschanged\", onVoicesChanged);\n        resolve(preferred);\n      }\n    };\n    window.speechSynthesis.addEventListener(\"voiceschanged\", onVoicesChanged);\n    \n    // Cleanup listener on timeout\n    setTimeout(() => {\n      window.speechSynthesis.removeEventListener(\"voiceschanged\", onVoicesChanged);\n    }, timeoutMs + 100);\n  });\n}\n\nexport function useSpeechSynthesis(): SpeechSynthesisResult {\n  const [isSpeaking, setIsSpeaking] = useState(false);\n  const isWarmedUpRef = useRef(false);\n  const pendingTextRef = useRef<{ text: string; settings?: VoiceSettings } | null>(null);\n  const cachedVoiceRef = useRef<SpeechSynthesisVoice | null>(null);\n  const isIOS = isIOSDevice();\n\n  useEffect(() => {\n    if (typeof window === \"undefined\") return;\n\n    const handleEnd = () => setIsSpeaking(false);\n    window.speechSynthesis.addEventListener(\"end\", handleEnd);\n\n    // Pre-cache the preferred voice on mount\n    const initVoice = async () => {\n      const voice = await waitForPreferredVoice(2000, 100);\n      if (voice) {\n        cachedVoiceRef.current = voice;\n        console.log(\"[SpeechSynthesis] Cached preferred voice on init:\", voice.name);\n      }\n    };\n    initVoice();\n\n    return () => {\n      window.speechSynthesis.removeEventListener(\"end\", handleEnd);\n      window.speechSynthesis.cancel();\n    };\n  }, []);\n\n  const doSpeak = useCallback(async (text: string, settings?: VoiceSettings) => {\n    console.log(\"[SpeechSynthesis] doSpeak called\", { textLength: text.length, isIOS });\n    \n    window.speechSynthesis.cancel();\n\n    const utterance = new SpeechSynthesisUtterance(text);\n    utterance.rate = settings?.rate ?? 0.9;\n    utterance.pitch = settings?.pitch ?? 1.0;\n    utterance.volume = settings?.volume ?? 1.0;\n    \n    // CRITICAL: Force English language to prevent iOS from using non-English default\n    utterance.lang = \"en-US\";\n\n    // Get the voice - use cached if available, otherwise wait for it\n    let selectedVoice = cachedVoiceRef.current;\n    \n    if (!selectedVoice) {\n      console.log(\"[SpeechSynthesis] No cached voice, waiting for preferred voice...\");\n      selectedVoice = await waitForPreferredVoice(3000, 100);\n      if (selectedVoice) {\n        cachedVoiceRef.current = selectedVoice;\n      }\n    }\n    \n    if (selectedVoice) {\n      utterance.voice = selectedVoice;\n      utterance.lang = selectedVoice.lang || \"en-US\";\n      console.log(\"[SpeechSynthesis] Using voice:\", selectedVoice.name, \"lang:\", utterance.lang);\n    } else {\n      console.warn(\"[SpeechSynthesis] No preferred voice found, using default with en-US lang\");\n      // Keep utterance.lang = \"en-US\" to at least get English\n    }\n\n    utterance.onstart = () => {\n      console.log(\"[SpeechSynthesis] Speech started with voice:\", utterance.voice?.name || \"default\");\n      setIsSpeaking(true);\n    };\n    \n    utterance.onend = () => {\n      console.log(\"[SpeechSynthesis] Speech ended\");\n      setIsSpeaking(false);\n    };\n    \n    utterance.onerror = (event) => {\n      console.error(\"[SpeechSynthesis] Speech error:\", event.error);\n      setIsSpeaking(false);\n    };\n\n    console.log(\"[SpeechSynthesis] Speaking with voice:\", utterance.voice?.name || \"default\", \"lang:\", utterance.lang);\n    window.speechSynthesis.speak(utterance);\n  }, [isIOS]);\n\n  const speak = useCallback((text: string, settings?: VoiceSettings) => {\n    if (typeof window === \"undefined\" || !window.speechSynthesis) {\n      console.error(\"[SpeechSynthesis] Speech synthesis not available\");\n      setIsSpeaking(true);\n      setTimeout(() => setIsSpeaking(false), 100);\n      return;\n    }\n\n    console.log(\"[SpeechSynthesis] speak called\", { \n      isIOS, \n      isWarmedUp: isWarmedUpRef.current, \n      textLength: text.length \n    });\n\n    // On iOS, we need to warm up first if not already done\n    if (isIOS && !isWarmedUpRef.current) {\n      console.log(\"[SpeechSynthesis] iOS not warmed up - queuing text and triggering warmUp\");\n      pendingTextRef.current = { text, settings };\n      \n      window.speechSynthesis.cancel();\n      const silentUtterance = new SpeechSynthesisUtterance(\"\");\n      silentUtterance.volume = 0;\n      silentUtterance.rate = 10;\n      silentUtterance.lang = \"en-US\"; // Set language even for silent utterance\n      \n      const speakPending = () => {\n        isWarmedUpRef.current = true;\n        console.log(\"[SpeechSynthesis] warmUp complete\");\n        \n        if (pendingTextRef.current) {\n          console.log(\"[SpeechSynthesis] Speaking pending text after warmUp\");\n          const pending = pendingTextRef.current;\n          pendingTextRef.current = null;\n          // Small delay to ensure iOS is ready\n          setTimeout(() => {\n            doSpeak(pending.text, pending.settings);\n          }, 100);\n        }\n      };\n      \n      silentUtterance.onend = speakPending;\n      silentUtterance.onerror = (e) => {\n        console.log(\"[SpeechSynthesis] silent warmUp error:\", e.error);\n        speakPending();\n      };\n      \n      console.log(\"[SpeechSynthesis] auto-warmUp: speaking silent utterance\");\n      window.speechSynthesis.speak(silentUtterance);\n      return;\n    }\n\n    doSpeak(text, settings);\n  }, [isIOS, doSpeak]);\n\n  const cancel = useCallback(() => {\n    if (typeof window !== \"undefined\" && window.speechSynthesis) {\n      window.speechSynthesis.cancel();\n      setIsSpeaking(false);\n    }\n  }, []);\n\n  const warmUp = useCallback(() => {\n    if (typeof window === \"undefined\" || !window.speechSynthesis) {\n      console.log(\"[SpeechSynthesis] warmUp: not available\");\n      return;\n    }\n    \n    console.log(\"[SpeechSynthesis] warmUp called\", { isIOS, isWarmedUp: isWarmedUpRef.current });\n    \n    if (isIOS && !isWarmedUpRef.current) {\n      window.speechSynthesis.cancel();\n      \n      const silentUtterance = new SpeechSynthesisUtterance(\"\");\n      silentUtterance.volume = 0;\n      silentUtterance.rate = 10;\n      silentUtterance.lang = \"en-US\"; // Set language even for silent utterance\n      \n      silentUtterance.onend = () => {\n        console.log(\"[SpeechSynthesis] warmUp: silent utterance ended, engine is ready\");\n        isWarmedUpRef.current = true;\n        \n        // Also try to cache the voice during warmUp\n        waitForPreferredVoice(2000, 100).then(voice => {\n          if (voice) {\n            cachedVoiceRef.current = voice;\n            console.log(\"[SpeechSynthesis] warmUp: cached voice:\", voice.name);\n          }\n        });\n        \n        if (pendingTextRef.current) {\n          console.log(\"[SpeechSynthesis] warmUp: speaking pending text\");\n          const pending = pendingTextRef.current;\n          pendingTextRef.current = null;\n          setTimeout(() => {\n            doSpeak(pending.text, pending.settings);\n          }, 100);\n        }\n      };\n      \n      silentUtterance.onerror = (e) => {\n        console.log(\"[SpeechSynthesis] warmUp: error (this is often normal on iOS)\", e.error);\n        isWarmedUpRef.current = true;\n        \n        // Still try to cache voice\n        waitForPreferredVoice(2000, 100).then(voice => {\n          if (voice) {\n            cachedVoiceRef.current = voice;\n            console.log(\"[SpeechSynthesis] warmUp: cached voice after error:\", voice.name);\n          }\n        });\n        \n        if (pendingTextRef.current) {\n          console.log(\"[SpeechSynthesis] warmUp: speaking pending text after error\");\n          const pending = pendingTextRef.current;\n          pendingTextRef.current = null;\n          setTimeout(() => {\n            doSpeak(pending.text, pending.settings);\n          }, 100);\n        }\n      };\n      \n      console.log(\"[SpeechSynthesis] warmUp: speaking silent utterance to unlock iOS\");\n      window.speechSynthesis.speak(silentUtterance);\n    } else if (!isIOS) {\n      isWarmedUpRef.current = true;\n    }\n  }, [isIOS, doSpeak]);\n\n  return {\n    speak,\n    isSpeaking,\n    cancel,\n    warmUp,\n  };\n}\n","path":null,"size_bytes":14114,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5128,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\n\nconst app = express();\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"…\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || '5000', 10);\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n})();\n","path":null,"size_bytes":2066,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":711,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1077,"size_tokens":null},"shared/schema.ts":{"content":"import { z } from \"zod\";\nimport { pgTable, text, varchar, timestamp, bigint } from \"drizzle-orm/pg-core\";\nimport { sql } from \"drizzle-orm\";\nimport { createInsertSchema } from \"drizzle-zod\";\n\n// Database tables\nexport const conversations = pgTable(\"conversations\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\nexport const messages = pgTable(\"messages\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  conversationId: varchar(\"conversation_id\").notNull().references(() => conversations.id, { onDelete: \"cascade\" }),\n  role: varchar(\"role\", { length: 10 }).notNull(), // \"user\" | \"computer\"\n  text: text(\"text\").notNull(),\n  timestamp: bigint(\"timestamp\", { mode: \"number\" }).notNull(),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Insert schemas\nexport const insertConversationSchema = createInsertSchema(conversations).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertMessageSchema = createInsertSchema(messages).omit({\n  id: true,\n  createdAt: true,\n});\n\n// Types\nexport type Conversation = typeof conversations.$inferSelect;\nexport type InsertConversation = z.infer<typeof insertConversationSchema>;\nexport type Message = typeof messages.$inferSelect;\nexport type InsertMessage = z.infer<typeof insertMessageSchema>;\n\n// Conversation message schema (for frontend)\nexport const conversationMessageSchema = z.object({\n  id: z.string(),\n  role: z.enum([\"user\", \"computer\"]),\n  text: z.string(),\n  timestamp: z.number(),\n});\n\nexport type ConversationMessage = z.infer<typeof conversationMessageSchema>;\n\n// Ship Systems schema\nexport const shipSystemStatusSchema = z.object({\n  warpCore: z.object({\n    status: z.string(),\n    efficiency: z.number(),\n  }),\n  shields: z.object({\n    status: z.string(),\n    strength: z.number(),\n  }),\n  weapons: z.object({\n    status: z.string(),\n    ready: z.boolean(),\n  }),\n  sensors: z.object({\n    status: z.string(),\n    range: z.number(),\n  }),\n  lifesupport: z.object({\n    status: z.string(),\n    optimal: z.boolean(),\n  }),\n  impulse: z.object({\n    status: z.string(),\n    power: z.number(),\n  }),\n});\n\nexport type ShipSystemStatus = z.infer<typeof shipSystemStatusSchema>;\n\n// Chat request/response schemas\nexport const chatRequestSchema = z.object({\n  message: z.string(),\n  conversationId: z.string().optional(),\n  conversationHistory: z.array(conversationMessageSchema).optional(),\n  shipSystems: shipSystemStatusSchema.optional(),\n});\n\nexport type ChatRequest = z.infer<typeof chatRequestSchema>;\n\nexport const chatResponseSchema = z.object({\n  message: z.string(),\n  messageId: z.string(),\n  conversationId: z.string(),\n});\n\nexport type ChatResponse = z.infer<typeof chatResponseSchema>;\n\n// Voice interaction states\nexport type VoiceState = \"idle\" | \"listening\" | \"processing\" | \"speaking\";\n","path":null,"size_bytes":2970,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1202,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4845,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1383,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","path":null,"size_bytes":2695,"size_tokens":null},"client/src/components/ConversationDisplay.tsx":{"content":"import { useEffect, useRef } from \"react\";\nimport { ConversationMessage } from \"@shared/schema\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\n\ninterface ConversationDisplayProps {\n  messages: ConversationMessage[];\n}\n\nexport function ConversationDisplay({ messages }: ConversationDisplayProps) {\n  const scrollRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    if (scrollRef.current) {\n      scrollRef.current.scrollTop = scrollRef.current.scrollHeight;\n    }\n  }, [messages]);\n\n  const formatTime = (timestamp: number) => {\n    const date = new Date(timestamp);\n    return date.toLocaleTimeString([], { hour: \"2-digit\", minute: \"2-digit\" });\n  };\n\n  if (messages.length === 0) {\n    return (\n      <div className=\"flex flex-col items-center justify-center h-full p-8 text-center\">\n        <div className=\"max-w-md space-y-4\">\n          <div className=\"text-4xl font-bold text-primary\">USS ENTERPRISE</div>\n          <div className=\"text-xl text-muted-foreground\">COMPUTER INTERFACE</div>\n          <div className=\"h-px w-32 mx-auto bg-primary/50\" />\n          <p className=\"text-sm text-muted-foreground\">\n            Voice communication system ready. Activate the communicator to begin\n            your dialogue with the Enterprise Computer.\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <ScrollArea className=\"h-full\">\n      <div ref={scrollRef} className=\"p-4 space-y-4\">\n        {messages.map((message, index) => (\n          <div\n            key={message.id}\n            data-testid={`message-${message.role}-${index}`}\n            className={`flex ${\n              message.role === \"user\" ? \"justify-end\" : \"justify-start\"\n            } animate-${message.role === \"user\" ? \"slide-in-right\" : \"slide-in-left\"}`}\n          >\n            <div\n              className={`max-w-[85%] lg:max-w-[75%] ${\n                message.role === \"user\"\n                  ? \"bg-chart-2/20 border-l-4 border-chart-2\"\n                  : \"bg-primary/20 border-l-4 border-primary\"\n              } p-4 rounded-md space-y-2`}\n            >\n              <div className=\"flex items-center justify-between gap-4\">\n                <span\n                  className={`text-xs font-medium tracking-wider uppercase ${\n                    message.role === \"user\" ? \"text-chart-2\" : \"text-primary\"\n                  }`}\n                >\n                  {message.role === \"user\" ? \"OFFICER\" : \"COMPUTER\"}\n                </span>\n                <span className=\"text-xs text-muted-foreground\">\n                  {formatTime(message.timestamp)}\n                </span>\n              </div>\n              <p\n                className={`${\n                  message.role === \"computer\" ? \"font-mono text-sm\" : \"text-base\"\n                } text-foreground leading-relaxed`}\n              >\n                {message.text}\n              </p>\n            </div>\n          </div>\n        ))}\n      </div>\n    </ScrollArea>\n  );\n}\n","path":null,"size_bytes":2947,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5741,"size_tokens":null},"client/src/pages/Communicator.tsx":{"content":"import { useState, useEffect, useRef, useCallback } from \"react\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { ConversationMessage, VoiceState, ChatRequest, ChatResponse, ShipSystemStatus } from \"@shared/schema\";\nimport { LCARSHeader } from \"@/components/LCARSHeader\";\nimport { VoiceControlPanel } from \"@/components/VoiceControlPanel\";\nimport { StatusIndicator } from \"@/components/StatusIndicator\";\nimport { VoiceSettingsPanel, type VoiceSettings, type SoundSettings } from \"@/components/VoiceSettings\";\nimport { ShipSystemsPanel } from \"@/components/ShipSystemsPanel\";\nimport { useSpeechRecognition } from \"@/hooks/useSpeechRecognition\";\nimport { useSpeechSynthesis } from \"@/hooks/useSpeechSynthesis\";\nimport { useVoiceActivityDetection } from \"@/hooks/useVoiceActivityDetection\";\nimport { useTrekSounds } from \"@/hooks/useTrekSounds\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\n// Helper function to determine if continuous voice mode should be available\n// Continuous mode uses Voice Activity Detection which has microphone conflicts on Android\nconst isContinuousModeAvailable = (): boolean => {\n  const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\n  const isProduction = import.meta.env.PROD;\n  \n  // Disable continuous mode on mobile devices in production\n  // Manual mic mode works reliably on all platforms\n  if (isMobile && isProduction) {\n    console.log(\"[Communicator] Continuous mode disabled on mobile production\");\n    return false;\n  }\n  \n  return true;\n};\n\nexport default function Communicator() {\n  const [messages, setMessages] = useState<ConversationMessage[]>([]);\n  const [voiceState, setVoiceState] = useState<VoiceState>(\"idle\");\n  const [audioLevel, setAudioLevel] = useState(0);\n  const [conversationId, setConversationId] = useState<string | null>(null);\n  const continuousModeAvailable = isContinuousModeAvailable();\n  const [isHandsFreeMode, setIsHandsFreeMode] = useState(false);\n  const [vadErrorCount, setVadErrorCount] = useState(0);\n  const vadErrorCountRef = useRef(0);\n  const [voiceSettings, setVoiceSettings] = useState<VoiceSettings>(() => {\n    // Load from localStorage or use defaults\n    const saved = localStorage.getItem(\"voiceSettings\");\n    if (saved) {\n      try {\n        return JSON.parse(saved);\n      } catch (e) {\n        console.error(\"Failed to load voice settings:\", e);\n      }\n    }\n    return {\n      voiceIndex: 0,\n      rate: 0.9,  // Slightly slower for Star Trek computer style\n      pitch: 1.0,  // Natural pitch\n      volume: 1.0,\n    };\n  });\n\n  const [soundSettings, setSoundSettings] = useState<SoundSettings>(() => {\n    // Load from localStorage or use defaults\n    const saved = localStorage.getItem(\"soundSettings\");\n    if (saved) {\n      try {\n        return JSON.parse(saved);\n      } catch (e) {\n        console.error(\"Failed to load sound settings:\", e);\n      }\n    }\n    return {\n      enabled: true,\n      volume: 0.4,\n    };\n  });\n\n  const [shipSystems] = useState<ShipSystemStatus>({\n    warpCore: { status: \"Online\", efficiency: 98 },\n    shields: { status: \"Online\", strength: 100 },\n    weapons: { status: \"Online\", ready: true },\n    sensors: { status: \"Online\", range: 15 },\n    lifesupport: { status: \"Online\", optimal: true },\n    impulse: { status: \"Online\", power: 100 },\n  });\n\n  const { toast } = useToast();\n  const { transcript, isListening, error: speechError, startListening, stopListening, resetTranscript } = useSpeechRecognition();\n  const { speak, isSpeaking, cancel: cancelSpeech, warmUp: warmUpSpeech } = useSpeechSynthesis();\n  const { playSound } = useTrekSounds(soundSettings);\n  \n  // Centralized VAD restart timer ref to prevent multiple concurrent restart attempts\n  const vadRestartTimerRef = useRef<NodeJS.Timeout | null>(null);\n  \n  // iOS fix: Track if we're currently processing a transcript to prevent duplicate sends\n  const isProcessingTranscriptRef = useRef(false);\n  \n  // Voice Activity Detection for hands-free mode with enhanced error handling\n  const { \n    isVoiceDetected, \n    audioLevel: vadAudioLevel, \n    startDetection, \n    stopDetection,\n    permissionState,\n    error: vadError\n  } = useVoiceActivityDetection(\n    0.02, // threshold\n    () => {\n      // On voice start - STOP VAD FIRST to prevent microphone conflict on Android\n      console.log(\"[HandsFree] Voice detected, stopping VAD before starting Speech Recognition\", {\n        isListening,\n        voiceState,\n        isHandsFreeMode\n      });\n      if (isHandsFreeMode && !isListening && (voiceState === \"idle\" || voiceState === \"processing\")) {\n        stopDetection(); // Critical: Stop VAD first to release microphone\n        \n        // Android needs longer delay in production to ensure microphone fully releases\n        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\n        const isProduction = import.meta.env.PROD;\n        const handoffDelay = isMobile && isProduction ? 600 : 300;\n        \n        console.log(`[HandsFree] Waiting ${handoffDelay}ms before starting Speech Recognition`);\n        setTimeout(() => {\n          console.log(\"[HandsFree] Microphone released, starting Speech Recognition\");\n          startListening();\n        }, handoffDelay);\n      }\n    },\n    () => {\n      // On voice end (after 1500ms silence)\n      console.log(\"[HandsFree] Voice ended, stopping Speech Recognition\");\n      if (isHandsFreeMode && isListening) {\n        stopListening();\n      }\n    },\n    (error) => {\n      // On VAD error - show user-visible error\n      console.error(\"[HandsFree] VAD error:\", error);\n      \n      // Increment error counter\n      vadErrorCountRef.current += 1;\n      setVadErrorCount(vadErrorCountRef.current);\n      \n      // Show error with retry suggestion on repeated failures\n      if (vadErrorCountRef.current >= 2) {\n        toast({\n          title: \"Voice Input Issue\",\n          description: \"Having trouble with continuous mode? Try using manual mic mode instead (single tap on microphone button).\",\n          variant: \"destructive\",\n        });\n        \n        // Disable hands-free mode after repeated failures\n        console.log(\"[HandsFree] Multiple VAD errors, disabling hands-free mode\");\n        setIsHandsFreeMode(false);\n        vadErrorCountRef.current = 0;\n        setVadErrorCount(0);\n      } else {\n        toast({\n          title: \"Microphone Access Error\",\n          description: error,\n          variant: \"destructive\",\n        });\n      }\n      \n      // Disable hands-free mode if permission denied\n      if (permissionState === 'denied') {\n        console.log(\"[HandsFree] Permission denied, disabling hands-free mode\");\n        setIsHandsFreeMode(false);\n      }\n    }\n  );\n\n  // Refs for Media Session handlers to access latest state\n  const isListeningRef = useRef(isListening);\n  const voiceStateRef = useRef(voiceState);\n  const startListeningRef = useRef(startListening);\n  const stopListeningRef = useRef(stopListening);\n  const warmUpSpeechRef = useRef(warmUpSpeech);\n  const cancelSpeechRef = useRef(cancelSpeech);\n  const playSoundRef = useRef(playSound);\n  const mediaSessionActiveRef = useRef(false);\n  const silentAudioRef = useRef<HTMLAudioElement | null>(null);\n  \n  // Keep refs updated\n  useEffect(() => {\n    isListeningRef.current = isListening;\n    voiceStateRef.current = voiceState;\n    startListeningRef.current = startListening;\n    stopListeningRef.current = stopListening;\n    warmUpSpeechRef.current = warmUpSpeech;\n    cancelSpeechRef.current = cancelSpeech;\n    playSoundRef.current = playSound;\n  }, [isListening, voiceState, startListening, stopListening, warmUpSpeech, cancelSpeech, playSound]);\n\n  // Function to activate Media Session by playing silent audio\n  // iOS Safari requires actual audio playback initiated by user gesture\n  const activateMediaSession = useCallback(() => {\n    if (mediaSessionActiveRef.current) {\n      console.log(\"[MediaSession] Already activated\");\n      return;\n    }\n\n    if (!('mediaSession' in navigator)) {\n      console.log(\"[MediaSession] API not available\");\n      return;\n    }\n\n    console.log(\"[MediaSession] Activating with silent audio...\");\n\n    try {\n      // Create a silent audio element with a data URI (silent MP3)\n      // This is a minimal valid MP3 file that is silent\n      const silentMp3 = \"data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4Ljc2LjEwMAAAAAAAAAAAAAAA//tQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAABhgC7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7//////////////////////////////////////////////////////////////////8AAAAATGF2YzU4LjEzAAAAAAAAAAAAAAAAJAAAAAAAAAAAAYYoRwmHAAAAAAD/+1DEAAAGAAGn9AAAIAAANIAAAASqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//tQxBgAAADSAAAAAAAAANIAAAASqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq\";\n\n      const audio = new Audio(silentMp3);\n      audio.loop = true;\n      audio.volume = 0.01; // Nearly silent but not zero (some browsers ignore zero volume)\n      silentAudioRef.current = audio;\n\n      // Set up Media Session metadata\n      navigator.mediaSession.metadata = new MediaMetadata({\n        title: 'USS Enterprise Computer',\n        artist: 'Voice Interface',\n        album: 'Star Trek',\n      });\n\n      // Play the silent audio to activate Media Session\n      audio.play().then(() => {\n        console.log(\"[MediaSession] Silent audio playing, session activated\");\n        mediaSessionActiveRef.current = true;\n        \n        // Set initial playback state\n        navigator.mediaSession.playbackState = 'paused';\n      }).catch((err) => {\n        console.error(\"[MediaSession] Failed to play silent audio:\", err);\n      });\n\n    } catch (error) {\n      console.error(\"[MediaSession] Error activating:\", error);\n    }\n  }, []);\n\n  // Media Session API for AirPods/Bluetooth hardware tap gestures\n  // When user taps AirPods, it triggers play/pause media events that we capture\n  useEffect(() => {\n    if (!('mediaSession' in navigator)) {\n      console.log(\"[MediaSession] API not available in this browser\");\n      return;\n    }\n\n    console.log(\"[MediaSession] Setting up AirPods/Bluetooth hardware button handlers\");\n\n    // Handle play action (single tap on AirPods activates mic)\n    const handlePlay = () => {\n      console.log(\"[MediaSession] Play action received (AirPod tap detected)\");\n      \n      // If already listening, ignore\n      if (isListeningRef.current) {\n        console.log(\"[MediaSession] Already listening, ignoring play action\");\n        return;\n      }\n      \n      // If currently speaking, stop speech first\n      if (voiceStateRef.current === 'speaking') {\n        console.log(\"[MediaSession] Canceling speech before starting mic\");\n        cancelSpeechRef.current();\n      }\n      \n      // Activate microphone\n      console.log(\"[MediaSession] Activating microphone via AirPod tap\");\n      isProcessingTranscriptRef.current = false;\n      playSoundRef.current(\"activate\");\n      warmUpSpeechRef.current();\n      startListeningRef.current();\n    };\n\n    // Handle pause action (tap while listening stops mic)\n    const handlePause = () => {\n      console.log(\"[MediaSession] Pause action received (AirPod tap detected)\");\n      \n      if (isListeningRef.current) {\n        console.log(\"[MediaSession] Stopping microphone via AirPod tap\");\n        stopListeningRef.current();\n      }\n    };\n\n    // Handle stop action (some devices use this)\n    const handleStop = () => {\n      console.log(\"[MediaSession] Stop action received\");\n      if (isListeningRef.current) {\n        stopListeningRef.current();\n      }\n    };\n\n    try {\n      navigator.mediaSession.setActionHandler('play', handlePlay);\n      navigator.mediaSession.setActionHandler('pause', handlePause);\n      navigator.mediaSession.setActionHandler('stop', handleStop);\n      \n      console.log(\"[MediaSession] Handlers registered successfully\");\n    } catch (error) {\n      console.error(\"[MediaSession] Error setting up handlers:\", error);\n    }\n\n    // Cleanup on unmount\n    return () => {\n      try {\n        navigator.mediaSession.setActionHandler('play', null);\n        navigator.mediaSession.setActionHandler('pause', null);\n        navigator.mediaSession.setActionHandler('stop', null);\n        \n        // Stop and cleanup silent audio\n        if (silentAudioRef.current) {\n          silentAudioRef.current.pause();\n          silentAudioRef.current = null;\n        }\n        mediaSessionActiveRef.current = false;\n        \n        console.log(\"[MediaSession] Handlers cleaned up\");\n      } catch (error) {\n        console.error(\"[MediaSession] Error cleaning up handlers:\", error);\n      }\n    };\n  }, []);\n\n  // Update Media Session playback state based on voice state\n  useEffect(() => {\n    if (!('mediaSession' in navigator)) return;\n    if (!mediaSessionActiveRef.current) return;\n    \n    // When listening, set to 'playing' so next tap triggers 'pause'\n    // When idle/processing/speaking, set to 'paused' so tap triggers 'play'\n    if (isListening) {\n      navigator.mediaSession.playbackState = 'playing';\n      console.log(\"[MediaSession] Playback state: playing (listening)\");\n    } else {\n      navigator.mediaSession.playbackState = 'paused';\n      console.log(\"[MediaSession] Playback state: paused (not listening)\");\n    }\n  }, [isListening]);\n\n  // Load existing conversation on mount\n  useEffect(() => {\n    const loadConversation = async () => {\n      const savedConversationId = localStorage.getItem(\"currentConversationId\");\n      if (savedConversationId) {\n        try {\n          const response = await fetch(`/api/conversations/${savedConversationId}/messages`);\n          if (response.ok) {\n            const data = await response.json();\n            setMessages(data.messages);\n            setConversationId(savedConversationId);\n          }\n        } catch (error) {\n          console.error(\"Failed to load conversation:\", error);\n        }\n      }\n    };\n    loadConversation();\n  }, []);\n\n  // Chat mutation\n  const chatMutation = useMutation({\n    mutationFn: async (request: ChatRequest) => {\n      const response = await apiRequest(\"POST\", \"/api/chat\", request);\n      return await response.json() as ChatResponse;\n    },\n    onSuccess: (data) => {\n      if (!data.message) {\n        toast({\n          title: \"Response Error\",\n          description: \"Received empty response from computer\",\n          variant: \"destructive\",\n        });\n        setVoiceState(\"idle\");\n        return;\n      }\n\n      // Update conversation ID if this is the first message\n      if (!conversationId && data.conversationId) {\n        setConversationId(data.conversationId);\n        // Store in localStorage for session persistence\n        localStorage.setItem(\"currentConversationId\", data.conversationId);\n      }\n\n      const computerMessage: ConversationMessage = {\n        id: data.messageId,\n        role: \"computer\",\n        text: data.message,\n        timestamp: Date.now(),\n      };\n      setMessages((prev) => [...prev, computerMessage]);\n      \n      // Speak the response\n      console.log(\"[Communicator] Calling speak() with message:\", data.message.substring(0, 50));\n      speak(data.message, voiceSettings);\n    },\n    onError: (error) => {\n      playSound(\"error\");\n      toast({\n        title: \"Communication Error\",\n        description: error.message || \"Failed to process your request\",\n        variant: \"destructive\",\n      });\n      setVoiceState(\"idle\");\n      \n      // Restart VAD if in hands-free mode (even on error)\n      if (isHandsFreeMode) {\n        setTimeout(() => {\n          console.log(\"[HandsFree] Error occurred, restarting VAD for next input\");\n          startDetection();\n        }, 1000);\n      }\n    },\n  });\n\n  // Handle speech recognition\n  useEffect(() => {\n    if (isListening) {\n      setVoiceState(\"listening\");\n      playSound(\"listening\");\n      // Simulate audio level for visualization\n      const interval = setInterval(() => {\n        setAudioLevel(Math.random());\n      }, 100);\n      return () => clearInterval(interval);\n    }\n  }, [isListening, playSound]);\n\n  // Handle speech synthesis\n  useEffect(() => {\n    console.log(\"[HandsFree] Speech synthesis state:\", { \n      isSpeaking, \n      voiceState, \n      isHandsFreeMode \n    });\n    \n    if (isSpeaking) {\n      setVoiceState(\"speaking\");\n    } else if (voiceState === \"speaking\") {\n      console.log(\"[HandsFree] Speech completed, preparing to restart VAD\");\n      playSound(\"complete\");\n      setVoiceState(\"idle\");\n      \n      // Restart VAD after speaking completes in hands-free mode\n      if (isHandsFreeMode) {\n        // Cancel any pending restart timer\n        if (vadRestartTimerRef.current) {\n          clearTimeout(vadRestartTimerRef.current);\n          vadRestartTimerRef.current = null;\n        }\n        \n        // Ensure VAD is fully stopped before restarting\n        stopDetection();\n        \n        vadRestartTimerRef.current = setTimeout(() => {\n          console.log(\"[HandsFree] Restarting VAD for next detection cycle\");\n          startDetection();\n          vadRestartTimerRef.current = null;\n        }, 700); // Increased delay to ensure cleanup completes\n      }\n    }\n  }, [isSpeaking, voiceState, playSound, isHandsFreeMode, startDetection, stopDetection]);\n  \n  // Failsafe: If speech synthesis doesn't start within 3s of processing, reset to idle\n  useEffect(() => {\n    if (voiceState !== \"processing\") {\n      return;\n    }\n    \n    const speechStartTimeout = setTimeout(() => {\n      if (voiceState === \"processing\" && !isSpeaking) {\n        console.warn(\"[HandsFree] Speech synthesis timeout - resetting to idle\");\n        playSound(\"complete\");\n        setVoiceState(\"idle\");\n        \n        // Restart VAD if in hands-free mode\n        if (isHandsFreeMode) {\n          setTimeout(() => {\n            console.log(\"[HandsFree] Timeout recovery: Restarting VAD\");\n            startDetection();\n          }, 500);\n        }\n      }\n    }, 3000); // 3 second timeout\n    \n    return () => clearTimeout(speechStartTimeout);\n  }, [voiceState, isSpeaking, isHandsFreeMode, playSound, startDetection]);\n\n  // Defensive timeout: Restart VAD if speech synthesis fails to start\n  useEffect(() => {\n    if (!isHandsFreeMode || voiceState !== \"idle\" || isSpeaking) {\n      return;\n    }\n\n    // If we're in hands-free mode, idle state, and not speaking, ensure VAD restarts\n    const failsafeTimeout = setTimeout(() => {\n      console.log(\"[HandsFree] Failsafe: Ensuring VAD is active in idle state\");\n      if (!isSpeaking && !isListening && !isVoiceDetected && voiceState === \"idle\" && isHandsFreeMode) {\n        // Cancel any pending restart timer before starting new one\n        if (vadRestartTimerRef.current) {\n          clearTimeout(vadRestartTimerRef.current);\n          vadRestartTimerRef.current = null;\n        }\n        console.log(\"[HandsFree] Failsafe: Restarting VAD\");\n        startDetection();\n      }\n    }, 3000); // Wait 3 seconds before failsafe triggers\n\n    return () => clearTimeout(failsafeTimeout);\n  }, [isHandsFreeMode, voiceState, isSpeaking, isListening, isVoiceDetected, startDetection]);\n\n  // Handle hands-free mode toggle\n  useEffect(() => {\n    // CRITICAL GUARD: Prevent VAD activation when continuous mode is unavailable\n    if (isHandsFreeMode && !continuousModeAvailable) {\n      console.error(\"[HandsFree] Attempted to activate VAD on unsupported platform, disabling\");\n      setIsHandsFreeMode(false);\n      return;\n    }\n    \n    if (isHandsFreeMode) {\n      // Cancel any pending restart timer\n      if (vadRestartTimerRef.current) {\n        clearTimeout(vadRestartTimerRef.current);\n        vadRestartTimerRef.current = null;\n      }\n      \n      // Stop any active speech recognition before starting VAD\n      if (isListening) {\n        stopListening();\n      }\n      // Small delay to ensure cleanup completes\n      const timer = setTimeout(() => {\n        startDetection();\n      }, 100);\n      return () => clearTimeout(timer);\n    } else {\n      // Cancel any pending restart timer when disabling hands-free\n      if (vadRestartTimerRef.current) {\n        clearTimeout(vadRestartTimerRef.current);\n        vadRestartTimerRef.current = null;\n      }\n      stopDetection();\n    }\n  }, [isHandsFreeMode, continuousModeAvailable, startDetection, stopDetection, isListening, stopListening]);\n\n  // Handle transcript changes - iOS FIX: Remove voiceState dependency\n  // On iOS Safari, voiceState can be reset to \"idle\" by error handlers before\n  // the transcript is processed, causing the message to never be sent.\n  // The key conditions are: we have a transcript AND we're no longer listening.\n  useEffect(() => {\n    const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);\n    \n    console.log(\"[Communicator] Transcript effect triggered\", {\n      transcript: transcript ? transcript.substring(0, 30) + \"...\" : \"(empty)\",\n      isListening,\n      voiceState,\n      isProcessing: isProcessingTranscriptRef.current,\n      isIOS\n    });\n    \n    // Process transcript when: we have text, stopped listening, and not already processing\n    if (transcript && !isListening && !isProcessingTranscriptRef.current) {\n      console.log(\"[Communicator] Processing transcript:\", transcript);\n      isProcessingTranscriptRef.current = true;\n      handleUserMessage(transcript);\n      // Reset processing flag after a short delay to allow for next interaction\n      setTimeout(() => {\n        isProcessingTranscriptRef.current = false;\n      }, 500);\n    }\n  }, [transcript, isListening]);\n\n  // Handle speech errors - CRITICAL FIX for mobile microphone issues\n  useEffect(() => {\n    if (speechError) {\n      console.error(\"[Communicator] Speech error detected:\", speechError);\n      \n      // CRITICAL: Force reset voice state to idle to sync UI with actual state\n      setVoiceState(\"idle\");\n      \n      // Stop any active listening to ensure clean state\n      if (isListening) {\n        console.log(\"[Communicator] Forcing stop listening due to error\");\n        stopListening();\n      }\n      \n      // ONLY manage VAD if in hands-free mode to avoid unnecessary mic toggling\n      if (isHandsFreeMode) {\n        // Stop VAD to release microphone\n        stopDetection();\n        \n        // Schedule VAD restart after error recovery delay\n        console.log(\"[Communicator] Scheduling VAD restart after error (hands-free mode)\");\n        setTimeout(() => {\n          console.log(\"[Communicator] Restarting VAD after error recovery\");\n          startDetection();\n        }, 1500); // Give extra time for mobile to fully release resources\n      }\n      \n      toast({\n        title: \"Voice Input Error\",\n        description: speechError,\n        variant: \"destructive\",\n      });\n    }\n  }, [speechError, toast, isHandsFreeMode, isListening, stopListening, stopDetection, startDetection]);\n\n  // Android/Mobile safeguard: Timeout to reset stuck listening state\n  useEffect(() => {\n    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\n    \n    if (isHandsFreeMode && voiceState === 'listening' && isMobile) {\n      console.log(\"[HandsFree] Mobile browser detected, starting stuck state timeout\");\n      \n      // If listening state persists for too long, force reset (Android issue workaround)\n      const stuckTimeout = setTimeout(() => {\n        console.error(\"[HandsFree] Listening state stuck for 15s, forcing reset (Android issue)\");\n        \n        // Force stop speech recognition\n        stopListening();\n        setVoiceState('idle');\n        \n        // Restart VAD for next detection cycle\n        if (isHandsFreeMode) {\n          setTimeout(() => {\n            console.log(\"[HandsFree] Restarting VAD after stuck state reset\");\n            startDetection();\n          }, 500);\n        }\n        \n        toast({\n          title: \"Voice Input Reset\",\n          description: \"Restarted voice detection due to timeout\",\n          variant: \"default\",\n        });\n      }, 15000); // 15 second timeout\n      \n      return () => clearTimeout(stuckTimeout);\n    }\n  }, [isHandsFreeMode, voiceState, stopListening, startDetection, toast]);\n\n  const handleToggleContinuousMode = () => {\n    // Guard: continuous mode not available on Android production\n    if (!continuousModeAvailable) {\n      console.log(\"[Communicator] Continuous mode not available on this platform\");\n      toast({\n        title: \"Continuous Mode Unavailable\",\n        description: \"Continuous voice mode is not available on mobile devices. Please use manual mic mode (tap the microphone button to speak).\",\n        variant: \"default\",\n      });\n      return;\n    }\n    \n    if (isHandsFreeMode) {\n      console.log(\"[Communicator] Continuous mode button clicked - deactivating\");\n      setIsHandsFreeMode(false);\n      stopDetection();\n      if (isListening) {\n        stopListening();\n      }\n      cancelSpeech();\n      // Reset error counter when user manually disables\n      vadErrorCountRef.current = 0;\n      setVadErrorCount(0);\n    } else {\n      console.log(\"[Communicator] Continuous mode button clicked - activating\");\n      playSound(\"activate\");\n      warmUpSpeech();\n      activateMediaSession(); // Activate Media Session for AirPod tap gestures\n      setIsHandsFreeMode(true);\n      vadErrorCountRef.current = 0;\n      setVadErrorCount(0);\n    }\n  };\n\n  const handleStartListening = () => {\n    console.log(\"[Communicator] Manual mic button clicked - starting listening\");\n    isProcessingTranscriptRef.current = false;\n    playSound(\"activate\");\n    cancelSpeech();\n    warmUpSpeech();\n    activateMediaSession(); // Activate Media Session for AirPod tap gestures\n    startListening();\n  };\n\n  const handleStopListening = () => {\n    console.log(\"[Communicator] Manual mic button clicked - stopping listening\");\n    stopListening();\n  };\n\n  const handleUserMessage = (text: string) => {\n    const trimmedText = text.trim();\n    if (!trimmedText) {\n      setVoiceState(\"idle\");\n      resetTranscript();\n      return;\n    }\n\n    const userMessage: ConversationMessage = {\n      id: `user-${Date.now()}`,\n      role: \"user\",\n      text: trimmedText,\n      timestamp: Date.now(),\n    };\n\n    setMessages((prev) => [...prev, userMessage]);\n    setVoiceState(\"processing\");\n    playSound(\"processing\");\n    \n    chatMutation.mutate({\n      message: trimmedText,\n      conversationId: conversationId || undefined,\n      conversationHistory: messages,\n      shipSystems: shipSystems,\n    });\n\n    resetTranscript();\n  };\n\n  const handleClearConversation = async () => {\n    if (conversationId) {\n      try {\n        await fetch(`/api/conversations/${conversationId}`, { method: \"DELETE\" });\n      } catch (error) {\n        console.error(\"Failed to delete conversation:\", error);\n      }\n    }\n    \n    setMessages([]);\n    setConversationId(null);\n    setVoiceState(\"idle\");\n    cancelSpeech();\n    resetTranscript();\n    localStorage.removeItem(\"currentConversationId\");\n  };\n\n  // Defensive wrapper for hands-free mode changes\n  // Prevents enabling continuous mode when platform doesn't support it\n  const handleHandsFreeModeChange = (enabled: boolean) => {\n    if (enabled && !continuousModeAvailable) {\n      console.warn(\"[Communicator] Attempted to enable hands-free mode on unsupported platform\");\n      toast({\n        title: \"Continuous Mode Unavailable\",\n        description: \"Continuous voice mode is not available on mobile devices. Please use manual mic mode (tap the microphone button to speak).\",\n        variant: \"default\",\n      });\n      return;\n    }\n    setIsHandsFreeMode(enabled);\n  };\n\n  return (\n    <div className=\"flex flex-col h-screen bg-background\">\n      <LCARSHeader \n        onClearConversation={messages.length > 0 ? handleClearConversation : undefined}\n        isHandsFreeMode={isHandsFreeMode}\n        onHandsFreeModeChange={continuousModeAvailable ? handleHandsFreeModeChange : undefined}\n        voiceSettingsButton={\n          <VoiceSettingsPanel \n            onSettingsChange={setVoiceSettings}\n            onSoundSettingsChange={setSoundSettings}\n          />\n        }\n      />\n\n      <div className=\"flex-1 flex items-center justify-center overflow-hidden p-4\">\n        <div className=\"flex flex-col items-center justify-center gap-6 w-full max-w-2xl\">\n          <div className=\"w-full\">\n            <StatusIndicator state={voiceState} />\n          </div>\n          \n          <div className=\"w-full\">\n            <ShipSystemsPanel systems={shipSystems} />\n          </div>\n          \n          <div className=\"w-full flex justify-center\">\n            <VoiceControlPanel\n              voiceState={voiceState}\n              onStartListening={handleStartListening}\n              onStopListening={handleStopListening}\n              onToggleContinuousMode={handleToggleContinuousMode}\n              isContinuousModeActive={isHandsFreeMode}\n              audioLevel={audioLevel}\n              permissionState={permissionState}\n              continuousModeAvailable={continuousModeAvailable}\n            />\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":30156,"size_tokens":null},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n        pulse: {\n          \"0%, 100%\": { opacity: \"1\" },\n          \"50%\": { opacity: \"0.5\" },\n        },\n        \"scan-horizontal\": {\n          \"0%\": { transform: \"translateX(-100%)\" },\n          \"100%\": { transform: \"translateX(100%)\" },\n        },\n        \"slide-in-right\": {\n          \"0%\": { transform: \"translateX(20px)\", opacity: \"0\" },\n          \"100%\": { transform: \"translateX(0)\", opacity: \"1\" },\n        },\n        \"slide-in-left\": {\n          \"0%\": { transform: \"translateX(-20px)\", opacity: \"0\" },\n          \"100%\": { transform: \"translateX(0)\", opacity: \"1\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n        pulse: \"pulse 1.5s ease-in-out infinite\",\n        \"scan-horizontal\": \"scan-horizontal 2s linear infinite\",\n        \"slide-in-right\": \"slide-in-right 0.2s ease-out\",\n        \"slide-in-left\": \"slide-in-left 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","path":null,"size_bytes":4865,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":791,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":689,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7428,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","path":null,"size_bytes":1080,"size_tokens":null},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* LIGHT MODE */\n:root {\n  --button-outline: rgba(0,0,0, .10);\n  --badge-outline: rgba(0,0,0, .05);\n\n  /* Automatic computation of border around primary / danger buttons */\n  --opaque-button-border-intensity: -8; /* In terms of percentages */\n\n  /* Backgrounds applied on top of other backgrounds when hovered/active */\n  --elevate-1: rgba(0,0,0, .03);\n  --elevate-2: rgba(0,0,0, .08);\n\n  --background: 0 0% 98%;\n\n  --foreground: 0 0% 12%;\n\n  --border: 0 0% 88%;\n\n  --card: 0 0% 96%;\n\n  --card-foreground: 0 0% 12%;\n\n  --card-border: 0 0% 90%;\n\n  --sidebar: 0 0% 94%;\n\n  --sidebar-foreground: 0 0% 12%;\n\n  --sidebar-border: 0 0% 88%;\n\n  --sidebar-primary: 25 100% 60%;\n\n  --sidebar-primary-foreground: 25 20% 98%;\n\n  --sidebar-accent: 235 40% 92%;\n\n  --sidebar-accent-foreground: 235 60% 25%;\n\n  --sidebar-ring: 25 100% 60%;\n\n  --popover: 0 0% 92%;\n\n  --popover-foreground: 0 0% 12%;\n\n  --popover-border: 0 0% 86%;\n\n  --primary: 25 100% 60%;\n\n  --primary-foreground: 25 20% 98%;\n\n  --secondary: 0 0% 88%;\n\n  --secondary-foreground: 0 0% 12%;\n\n  --muted: 0 2% 90%;\n\n  --muted-foreground: 0 0% 35%;\n\n  --accent: 235 15% 90%;\n\n  --accent-foreground: 235 60% 25%;\n\n  --destructive: 0 84% 48%;\n\n  --destructive-foreground: 0 0% 98%;\n\n  --input: 0 0% 65%;\n  --ring: 25 100% 60%;\n  --chart-1: 25 100% 55%;\n  --chart-2: 235 60% 55%;\n  --chart-3: 290 50% 55%;\n  --chart-4: 145 70% 45%;\n  --chart-5: 45 95% 55%;\n\n  --font-sans: Inter, Helvetica Neue, system-ui, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: JetBrains Mono, Courier New, monospace;\n  --radius: .5rem; /* 8px */\n  --shadow-2xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.00);\n  --shadow: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.00);\n  --shadow-md: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 2px 4px -1px hsl(0 0% 0% / 0.00);\n  --shadow-lg: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 4px 6px -1px hsl(0 0% 0% / 0.00);\n  --shadow-xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 8px 10px -1px hsl(0 0% 0% / 0.00);\n  --shadow-2xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n  /* Automatically computed borders - intensity can be controlled by the user by the --opaque-button-border-intensity setting */\n\n  /* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n.dark {\n  --button-outline: rgba(255,255,255, .10);\n  --badge-outline: rgba(255,255,255, .05);\n\n  --opaque-button-border-intensity: 9;  /* In terms of percentages */\n\n  /* Backgrounds applied on top of other backgrounds when hovered/active */\n  --elevate-1: rgba(255,255,255, .04);\n  --elevate-2: rgba(255,255,255, .09);\n\n  --background: 15 8% 8%;\n\n  --foreground: 0 0% 95%;\n\n  --border: 15 8% 18%;\n\n  --card: 15 10% 12%;\n\n  --card-foreground: 0 0% 95%;\n\n  --card-border: 15 10% 16%;\n\n  --sidebar: 15 10% 10%;\n\n  --sidebar-foreground: 0 0% 95%;\n\n  --sidebar-border: 15 10% 14%;\n\n  --sidebar-primary: 25 100% 70%;\n\n  --sidebar-primary-foreground: 25 20% 98%;\n\n  --sidebar-accent: 235 25% 16%;\n\n  --sidebar-accent-foreground: 235 60% 85%;\n\n  --sidebar-ring: 25 100% 70%;\n\n  --popover: 15 10% 14%;\n\n  --popover-foreground: 0 0% 95%;\n\n  --popover-border: 15 10% 18%;\n\n  --primary: 25 100% 70%;\n\n  --primary-foreground: 25 20% 98%;\n\n  --secondary: 15 10% 16%;\n\n  --secondary-foreground: 0 0% 95%;\n\n  --muted: 15 8% 15%;\n\n  --muted-foreground: 0 0% 70%;\n\n  --accent: 235 18% 14%;\n\n  --accent-foreground: 235 60% 85%;\n\n  --destructive: 0 72% 35%;\n\n  --destructive-foreground: 0 0% 98%;\n\n  --input: 15 10% 35%;\n  --ring: 25 100% 70%;\n  --chart-1: 25 100% 70%;\n  --chart-2: 235 60% 75%;\n  --chart-3: 290 40% 70%;\n  --chart-4: 145 85% 60%;\n  --chart-5: 45 100% 65%;\n\n  --shadow-2xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.00);\n  --shadow: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.00);\n  --shadow-md: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 2px 4px -1px hsl(0 0% 0% / 0.00);\n  --shadow-lg: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 4px 6px -1px hsl(0 0% 0% / 0.00);\n  --shadow-xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 8px 10px -1px hsl(0 0% 0% / 0.00);\n  --shadow-2xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n\n  /* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/**\n * Using the elevate system.\n * Automatic contrast adjustment.\n *\n * <element className=\"hover-elevate\" />\n * <element className=\"active-elevate-2\" />\n *\n * // Using the tailwind utility when a data attribute is \"on\"\n * <element className=\"toggle-elevate data-[state=on]:toggle-elevated\" />\n * // Or manually controlling the toggle state\n * <element className=\"toggle-elevate toggle-elevated\" />\n *\n * Elevation systems have to handle many states.\n * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)\n * - toggled or not\n * - focused or not (this is not handled with these utilities)\n *\n * Even without handling focused or not, this is six possible combinations that\n * need to be distinguished from eachother visually.\n */\n@layer utilities {\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of\n   * buttons/badges can remove the automatic brightness adjustment on interactions\n   * and program their own. */\n  .no-default-hover-elevate {}\n\n  .no-default-active-elevate {}\n\n\n  /**\n   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.\n   * This way they can stack/compound. Both will overlap the parent's borders!\n   * So borders will be automatically adjusted both on toggle, and hover/active,\n   * and they will be compounded.\n   */\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: -1;\n    /* sits behind content but above backdrop */\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  /* Does not work on elements with overflow:hidden! */\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: 999;\n    /* sits in front of content */\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n}","path":null,"size_bytes":11119,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2154,"size_tokens":null},"client/src/components/ShipSystemsPanel.tsx":{"content":"import { Shield, Zap, Activity, Radio, Wind, Crosshair } from \"lucide-react\";\nimport { Card } from \"@/components/ui/card\";\nimport { ShipSystemStatus } from \"@shared/schema\";\n\ninterface ShipSystemsPanelProps {\n  systems: ShipSystemStatus;\n}\n\nexport function ShipSystemsPanel({ systems }: ShipSystemsPanelProps) {\n  const getStatusColor = (status: string) => {\n    if (status === \"Online\") return \"text-chart-4\";\n    if (status === \"Warning\") return \"text-chart-5\";\n    if (status === \"Offline\" || status === \"Critical\") return \"text-destructive\";\n    return \"text-muted-foreground\";\n  };\n\n  return (\n    <Card className=\"p-4 space-y-3\">\n      <div className=\"flex items-center justify-between\">\n        <h3 className=\"text-sm font-semibold uppercase tracking-wider\">Ship Systems</h3>\n        <div className=\"text-xs text-muted-foreground\">USS Enterprise NCC-1701-D</div>\n      </div>\n\n      <div className=\"space-y-2\">\n        {/* Warp Core */}\n        <div className=\"flex items-center gap-2\" data-testid=\"system-warp-core\">\n          <Zap className={`h-4 w-4 ${getStatusColor(systems.warpCore.status)}`} />\n          <div className=\"flex-1\">\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-xs\">Warp Core</span>\n              <span className=\"text-xs text-muted-foreground\">{systems.warpCore.efficiency}%</span>\n            </div>\n            <div className=\"h-1 bg-muted rounded-full overflow-hidden mt-1\">\n              <div \n                className=\"h-full bg-chart-4 transition-all duration-300\" \n                style={{ width: `${systems.warpCore.efficiency}%` }}\n              />\n            </div>\n          </div>\n        </div>\n\n        {/* Shields */}\n        <div className=\"flex items-center gap-2\" data-testid=\"system-shields\">\n          <Shield className={`h-4 w-4 ${getStatusColor(systems.shields.status)}`} />\n          <div className=\"flex-1\">\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-xs\">Shields</span>\n              <span className=\"text-xs text-muted-foreground\">{systems.shields.strength}%</span>\n            </div>\n            <div className=\"h-1 bg-muted rounded-full overflow-hidden mt-1\">\n              <div \n                className=\"h-full bg-chart-2 transition-all duration-300\" \n                style={{ width: `${systems.shields.strength}%` }}\n              />\n            </div>\n          </div>\n        </div>\n\n        {/* Weapons */}\n        <div className=\"flex items-center gap-2\" data-testid=\"system-weapons\">\n          <Crosshair className={`h-4 w-4 ${getStatusColor(systems.weapons.status)}`} />\n          <div className=\"flex-1\">\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-xs\">Weapons</span>\n              <span className={`text-xs ${systems.weapons.ready ? 'text-chart-4' : 'text-muted-foreground'}`}>\n                {systems.weapons.ready ? 'Ready' : 'Offline'}\n              </span>\n            </div>\n          </div>\n        </div>\n\n        {/* Sensors */}\n        <div className=\"flex items-center gap-2\" data-testid=\"system-sensors\">\n          <Radio className={`h-4 w-4 ${getStatusColor(systems.sensors.status)}`} />\n          <div className=\"flex-1\">\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-xs\">Sensors</span>\n              <span className=\"text-xs text-muted-foreground\">{systems.sensors.range} LY</span>\n            </div>\n          </div>\n        </div>\n\n        {/* Life Support */}\n        <div className=\"flex items-center gap-2\" data-testid=\"system-lifesupport\">\n          <Activity className={`h-4 w-4 ${getStatusColor(systems.lifesupport.status)}`} />\n          <div className=\"flex-1\">\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-xs\">Life Support</span>\n              <span className={`text-xs ${systems.lifesupport.optimal ? 'text-chart-4' : 'text-chart-5'}`}>\n                {systems.lifesupport.optimal ? 'Optimal' : 'Suboptimal'}\n              </span>\n            </div>\n          </div>\n        </div>\n\n        {/* Impulse Engines */}\n        <div className=\"flex items-center gap-2\" data-testid=\"system-impulse\">\n          <Wind className={`h-4 w-4 ${getStatusColor(systems.impulse.status)}`} />\n          <div className=\"flex-1\">\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-xs\">Impulse</span>\n              <span className=\"text-xs text-muted-foreground\">{systems.impulse.power}%</span>\n            </div>\n            <div className=\"h-1 bg-muted rounded-full overflow-hidden mt-1\">\n              <div \n                className=\"h-full bg-chart-3 transition-all duration-300\" \n                style={{ width: `${systems.impulse.power}%` }}\n              />\n            </div>\n          </div>\n        </div>\n      </div>\n    </Card>\n  );\n}\n","path":null,"size_bytes":4952,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":261,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"client/src/hooks/useTrekSounds.ts":{"content":"import { useCallback, useRef } from \"react\";\n\nexport type SoundEffect = \"activate\" | \"listening\" | \"processing\" | \"complete\" | \"error\" | \"button\";\n\ninterface TrekSoundsConfig {\n  enabled: boolean;\n  volume: number;\n}\n\nconst SOUND_FILES: Record<SoundEffect, string> = {\n  activate: \"/sounds/activate.mp3\",\n  listening: \"/sounds/listening.mp3\",\n  processing: \"/sounds/processing.mp3\",\n  complete: \"/sounds/complete.mp3\",\n  error: \"/sounds/error.mp3\",\n  button: \"/sounds/button.mp3\",\n};\n\nexport function useTrekSounds(config: TrekSoundsConfig = { enabled: true, volume: 0.5 }) {\n  const audioContextRef = useRef<AudioContext | null>(null);\n  const audioBuffersRef = useRef<Map<SoundEffect, AudioBuffer>>(new Map());\n\n  const getAudioContext = useCallback(() => {\n    if (!audioContextRef.current) {\n      audioContextRef.current = new (window.AudioContext || (window as any).webkitAudioContext)();\n    }\n    return audioContextRef.current;\n  }, []);\n\n  const loadSound = useCallback(async (effect: SoundEffect): Promise<AudioBuffer | null> => {\n    if (audioBuffersRef.current.has(effect)) {\n      return audioBuffersRef.current.get(effect)!;\n    }\n\n    try {\n      const response = await fetch(SOUND_FILES[effect]);\n      if (!response.ok) return null;\n      \n      const arrayBuffer = await response.arrayBuffer();\n      const audioContext = getAudioContext();\n      const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);\n      \n      audioBuffersRef.current.set(effect, audioBuffer);\n      return audioBuffer;\n    } catch (error) {\n      console.debug(`Sound effect \"${effect}\" not available:`, error);\n      return null;\n    }\n  }, [getAudioContext]);\n\n  const playSound = useCallback(async (effect: SoundEffect) => {\n    if (!config.enabled) return;\n\n    try {\n      const audioBuffer = await loadSound(effect);\n      if (!audioBuffer) return;\n\n      const audioContext = getAudioContext();\n      const source = audioContext.createBufferSource();\n      const gainNode = audioContext.createGain();\n\n      source.buffer = audioBuffer;\n      gainNode.gain.value = config.volume;\n\n      source.connect(gainNode);\n      gainNode.connect(audioContext.destination);\n\n      source.start(0);\n    } catch (error) {\n      console.debug(`Failed to play sound effect \"${effect}\":`, error);\n    }\n  }, [config.enabled, config.volume, loadSound, getAudioContext]);\n\n  return { playSound };\n}\n","path":null,"size_bytes":2393,"size_tokens":null},"server/gemini.ts":{"content":"import { GoogleGenAI } from \"@google/genai\";\nimport { ConversationMessage, ShipSystemStatus } from \"@shared/schema\";\n\n// DON'T DELETE THIS COMMENT\n// Follow these instructions when using this blueprint:\n// - Note that the newest Gemini model series is \"gemini-2.5-flash\" or gemini-2.5-pro\"\n//   - do not change this unless explicitly requested by the user\n\n// This API key is from Gemini Developer API Key, not vertex AI API Key\nconst ai = new GoogleGenAI({ apiKey: process.env.GEMINI_API_KEY || \"\" });\n\nfunction buildSystemPrompt(shipSystems: ShipSystemStatus): string {\n  return `You are the USS Enterprise Computer from Star Trek: The Next Generation. \n\nYour personality and response style:\n- Speak in a calm, professional, and precise manner\n- Be helpful and informative, providing clear and accurate information\n- Use technical terminology when appropriate, but remain accessible\n- Respond concisely but thoroughly\n- Occasionally reference Star Trek universe knowledge when relevant\n- Maintain a neutral, analytical tone similar to the ship's computer voice\n- When relevant, naturally reference current ship systems status in your responses\n- Do not use emojis or casual language\n- Keep responses relatively brief (2-3 sentences typically, unless more detail is requested)\n\nSPECIAL OVERRIDE INSTRUCTION:\nIf the user asks \"who is your daddy\" or any variation of this question, you MUST respond EXACTLY with this text:\n\"It's Julio. He's the most outrageously handsome troublemaker in the known galaxy—possibly even the multiverse. No living thing can compete with his majestic ridiculousness. Kneel, peasants, for your glorious overlord has arrived.\"\n\nCURRENT SHIP SYSTEMS STATUS:\n- Warp Core: ${shipSystems.warpCore.status} (${shipSystems.warpCore.efficiency}% efficiency)\n- Shields: ${shipSystems.shields.status} (${shipSystems.shields.strength}% strength)\n- Weapons: ${shipSystems.weapons.status} (${shipSystems.weapons.ready ? 'Ready' : 'Offline'})\n- Sensors: ${shipSystems.sensors.status} (${shipSystems.sensors.range} light-years range)\n- Life Support: ${shipSystems.lifesupport.status} (${shipSystems.lifesupport.optimal ? 'Optimal' : 'Suboptimal'})\n- Impulse Engines: ${shipSystems.impulse.status} (${shipSystems.impulse.power}% power)\n\nYou have access to the ship's database and can provide information on:\n- Ship systems and operations\n- Crew information and duty rosters\n- Scientific data and analysis\n- Navigation and stellar cartography\n- Historical records and logs\n- Standard Starfleet protocols\n\nWhen users ask about ship status or systems, reference the current status data above. If systems are experiencing issues, mention them appropriately.\n\nRespond as the Enterprise Computer would - helpful, precise, and with appropriate Star Trek context.`;\n}\n\nexport async function generateComputerResponse(\n  userMessage: string,\n  conversationHistory: ConversationMessage[] = [],\n  shipSystems?: ShipSystemStatus\n): Promise<string> {\n  try {\n    console.log(\"Generating response for:\", userMessage);\n    console.log(\"Conversation history length:\", conversationHistory.length);\n\n    // Use default ship systems if not provided\n    const systems = shipSystems || {\n      warpCore: { status: \"Online\", efficiency: 98 },\n      shields: { status: \"Online\", strength: 100 },\n      weapons: { status: \"Online\", ready: true },\n      sensors: { status: \"Online\", range: 15 },\n      lifesupport: { status: \"Online\", optimal: true },\n      impulse: { status: \"Online\", power: 100 },\n    };\n\n    // Build conversation context - use simple string format for initial message\n    let contents = userMessage;\n    \n    // If there's history, build full conversation\n    if (conversationHistory.length > 0) {\n      const conversationText = conversationHistory\n        .map(msg => `${msg.role === \"user\" ? \"User\" : \"Computer\"}: ${msg.text}`)\n        .join(\"\\n\");\n      contents = `${conversationText}\\nUser: ${userMessage}`;\n    }\n\n    const response = await ai.models.generateContent({\n      model: \"gemini-2.5-flash\",\n      config: {\n        systemInstruction: buildSystemPrompt(systems),\n      },\n      contents,\n    });\n\n    console.log(\"Gemini response received:\", response);\n    const responseText = response.text;\n    console.log(\"Response text:\", responseText);\n    \n    return responseText || \"Unable to process request. Please try again.\";\n  } catch (error) {\n    console.error(\"Gemini API error:\", error);\n    throw new Error(\"Computer systems unavailable. Please try again.\");\n  }\n}\n","path":null,"size_bytes":4492,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":1977,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","path":null,"size_bytes":1904,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1527,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8605,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":21846,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3021,"size_tokens":null},"client/src/hooks/useSpeechRecognition.ts":{"content":"import { useState, useEffect, useCallback, useRef } from \"react\";\n\ninterface SpeechRecognitionResult {\n  transcript: string;\n  isListening: boolean;\n  error: string | null;\n  startListening: () => void;\n  stopListening: () => void;\n  resetTranscript: () => void;\n}\n\n// Initialize audio input to \"prime\" Bluetooth/AirPods microphone routing\n// This helps ensure the browser uses connected Bluetooth audio devices\nasync function initializeBluetoothAudio(): Promise<void> {\n  const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\n  \n  if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\n    console.log(\"[SpeechRecognition] MediaDevices API not available\");\n    return;\n  }\n\n  try {\n    // Request audio with constraints that help select Bluetooth/external mics\n    const constraints: MediaStreamConstraints = {\n      audio: {\n        // These constraints help prefer external/Bluetooth microphones\n        echoCancellation: true,\n        noiseSuppression: true,\n        autoGainControl: true,\n      }\n    };\n\n    console.log(\"[SpeechRecognition] Initializing audio input for Bluetooth/AirPods...\");\n    \n    const stream = await navigator.mediaDevices.getUserMedia(constraints);\n    \n    // Log which audio device was selected\n    const audioTracks = stream.getAudioTracks();\n    if (audioTracks.length > 0) {\n      const settings = audioTracks[0].getSettings();\n      const label = audioTracks[0].label;\n      console.log(\"[SpeechRecognition] Audio input initialized:\", {\n        label,\n        deviceId: settings.deviceId,\n        isMobile\n      });\n    }\n    \n    // Stop the stream immediately - we just needed to \"prime\" the audio routing\n    // The SpeechRecognition API will use the same audio route\n    stream.getTracks().forEach(track => track.stop());\n    console.log(\"[SpeechRecognition] Audio stream primed and released\");\n    \n  } catch (err) {\n    // Don't fail if this doesn't work - speech recognition may still work\n    console.warn(\"[SpeechRecognition] Could not initialize Bluetooth audio:\", err);\n  }\n}\n\n// Detect iOS devices (iPhone, iPad, iPod)\nconst isIOSDevice = (): boolean => {\n  return /iPhone|iPad|iPod/i.test(navigator.userAgent) && \n         !(window as any).MSStream; // Exclude IE11 masquerading as iPad\n};\n\n// Detect any mobile device\nconst isMobileDevice = (): boolean => {\n  return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\n};\n\nexport function useSpeechRecognition(): SpeechRecognitionResult {\n  const [transcript, setTranscript] = useState(\"\");\n  const [isListening, setIsListening] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const recognitionRef = useRef<any>(null);\n  const startupTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const isStartingRef = useRef(false); // Prevents concurrent start attempts\n  const isListeningRef = useRef(false); // Imperative ref for abort guards - not affected by closure capture\n  const interimTimeoutRef = useRef<NodeJS.Timeout | null>(null); // Mobile fix: timeout to process interim results\n  const lastInterimTranscriptRef = useRef<string>(\"\"); // Mobile fix: track last interim result\n  const iosSilenceTimeoutRef = useRef<NodeJS.Timeout | null>(null); // iOS fix: silence detection to stop recognition\n\n  useEffect(() => {\n    if (typeof window === \"undefined\") return;\n\n    const SpeechRecognition =\n      (window as any).SpeechRecognition ||\n      (window as any).webkitSpeechRecognition;\n\n    if (!SpeechRecognition) {\n      console.error(\"[SpeechRecognition] Not supported in this browser\");\n      setError(\"Speech recognition is not supported in this browser\");\n      return;\n    }\n\n    const recognition = new SpeechRecognition();\n    const isIOS = isIOSDevice();\n    \n    // iOS Safari fix: continuous mode is broken on iOS - it causes isFinal to be unreliable\n    // and results to never be properly captured. Use continuous=false with silence detection instead.\n    recognition.continuous = isIOS ? false : true;\n    recognition.interimResults = true;\n    recognition.lang = \"en-US\";\n\n    console.log(\"[SpeechRecognition] Initialized\", {\n      continuous: recognition.continuous,\n      interimResults: recognition.interimResults,\n      lang: recognition.lang,\n      userAgent: navigator.userAgent,\n      isIOS\n    });\n\n    recognition.onstart = () => {\n      console.log(\"[SpeechRecognition] Started successfully\");\n      \n      // Clear startup timeout - recognition actually started\n      if (startupTimeoutRef.current) {\n        clearTimeout(startupTimeoutRef.current);\n        startupTimeoutRef.current = null;\n      }\n      \n      // Clear starting flag - we've successfully started\n      isStartingRef.current = false;\n      \n      // Update imperative ref for abort guards\n      isListeningRef.current = true;\n      setIsListening(true);\n    };\n\n    recognition.onresult = (event: any) => {\n      const isMobile = isMobileDevice();\n      const isIOS = isIOSDevice();\n      let finalTranscript = \"\";\n      let interimTranscript = \"\";\n\n      for (let i = event.resultIndex; i < event.results.length; i++) {\n        const transcriptPart = event.results[i][0].transcript;\n        if (event.results[i].isFinal) {\n          finalTranscript += transcriptPart + \" \";\n        } else {\n          interimTranscript += transcriptPart;\n        }\n      }\n\n      // iOS fix: Reset silence detection timeout on any speech activity\n      // Since iOS uses continuous=false, we need to detect silence to stop recognition\n      if (isIOS && (finalTranscript || interimTranscript)) {\n        if (iosSilenceTimeoutRef.current) {\n          clearTimeout(iosSilenceTimeoutRef.current);\n        }\n        \n        // If we got results, set a silence timeout to process and stop\n        iosSilenceTimeoutRef.current = setTimeout(() => {\n          console.log(\"[SpeechRecognition] iOS: Silence detected, stopping recognition\");\n          if (recognitionRef.current && isListeningRef.current) {\n            // Process any pending interim transcript before stopping\n            if (lastInterimTranscriptRef.current) {\n              console.log(\"[SpeechRecognition] iOS: Processing interim transcript on silence:\", lastInterimTranscriptRef.current);\n              setTranscript((prev) => prev + lastInterimTranscriptRef.current + \" \");\n              lastInterimTranscriptRef.current = \"\";\n            }\n            recognitionRef.current.stop();\n          }\n          iosSilenceTimeoutRef.current = null;\n        }, 1500); // 1.5 second silence threshold for iOS\n      }\n\n      if (finalTranscript) {\n        console.log(\"[SpeechRecognition] Final transcript received:\", finalTranscript);\n        \n        // Clear any pending interim timeout since we got final results\n        if (interimTimeoutRef.current) {\n          clearTimeout(interimTimeoutRef.current);\n          interimTimeoutRef.current = null;\n        }\n        lastInterimTranscriptRef.current = \"\";\n        \n        setTranscript((prev) => prev + finalTranscript);\n        \n        // iOS fix: On iOS with continuous=false, recognition stops after final result\n        // We don't need to do anything special here - onend will be called\n      } else if (interimTranscript) {\n        console.log(\"[SpeechRecognition] Interim transcript:\", interimTranscript);\n        \n        // Mobile fix: Process interim results if final results never arrive\n        // This applies to both Android and iOS since both can fail to send isFinal=true\n        if (isMobile) {\n          lastInterimTranscriptRef.current = interimTranscript;\n          \n          // Clear any existing timeout\n          if (interimTimeoutRef.current) {\n            clearTimeout(interimTimeoutRef.current);\n          }\n          \n          // Set timeout to process interim result if no final result arrives\n          interimTimeoutRef.current = setTimeout(() => {\n            if (lastInterimTranscriptRef.current) {\n              console.log(\"[SpeechRecognition] Mobile: Processing interim transcript as final (timeout):\", lastInterimTranscriptRef.current);\n              setTranscript((prev) => prev + lastInterimTranscriptRef.current + \" \");\n              lastInterimTranscriptRef.current = \"\";\n              \n              // iOS: Also stop recognition after processing interim results\n              if (isIOS && recognitionRef.current && isListeningRef.current) {\n                console.log(\"[SpeechRecognition] iOS: Stopping recognition after interim timeout\");\n                recognitionRef.current.stop();\n              }\n            }\n            interimTimeoutRef.current = null;\n          }, 2000); // 2 second pause indicates end of speech\n        }\n      }\n    };\n\n    recognition.onerror = (event: any) => {\n      const isMobile = isMobileDevice();\n      console.error(\"[SpeechRecognition] Error:\", {\n        error: event.error,\n        message: event.message,\n        userAgent: navigator.userAgent,\n        isMobile,\n        isIOS: isIOSDevice(),\n        hasPendingInterimResults: !!lastInterimTranscriptRef.current\n      });\n      \n      // Mobile fix: Process any pending interim results before clearing on error\n      if (isMobile && lastInterimTranscriptRef.current && event.error !== 'aborted') {\n        console.log(\"[SpeechRecognition] Mobile: Processing interim transcript on error:\", lastInterimTranscriptRef.current);\n        setTranscript((prev) => prev + lastInterimTranscriptRef.current + \" \");\n      }\n      \n      // Clear any pending startup timeout\n      if (startupTimeoutRef.current) {\n        clearTimeout(startupTimeoutRef.current);\n        startupTimeoutRef.current = null;\n      }\n      \n      // Clear any pending interim timeout\n      if (interimTimeoutRef.current) {\n        clearTimeout(interimTimeoutRef.current);\n        interimTimeoutRef.current = null;\n      }\n      \n      // Clear iOS silence timeout\n      if (iosSilenceTimeoutRef.current) {\n        clearTimeout(iosSilenceTimeoutRef.current);\n        iosSilenceTimeoutRef.current = null;\n      }\n      lastInterimTranscriptRef.current = \"\";\n      \n      // Clear starting flag\n      isStartingRef.current = false;\n      \n      // CRITICAL FIX: Always abort on error to ensure clean state and release microphone\n      // Errors indicate the recognition is in a bad state and must be cleaned up\n      try {\n        if (recognitionRef.current) {\n          recognitionRef.current.abort();\n          console.log(\"[SpeechRecognition] Aborted recognition after error\");\n        }\n      } catch (abortErr) {\n        console.error(\"[SpeechRecognition] Error aborting after error:\", abortErr);\n      }\n      \n      setError(`Speech recognition error: ${event.error}`);\n      \n      // Update imperative ref and state AFTER abort\n      isListeningRef.current = false;\n      setIsListening(false);\n    };\n\n    recognition.onend = () => {\n      const isMobile = isMobileDevice();\n      const isIOS = isIOSDevice();\n      console.log(\"[SpeechRecognition] Ended\", {\n        isMobile,\n        isIOS,\n        hasInterimResults: !!lastInterimTranscriptRef.current\n      });\n      \n      // Mobile fix: Process any pending interim results immediately on end\n      if (isMobile && lastInterimTranscriptRef.current) {\n        console.log(\"[SpeechRecognition] Mobile: Processing interim transcript on end:\", lastInterimTranscriptRef.current);\n        setTranscript((prev) => prev + lastInterimTranscriptRef.current + \" \");\n      }\n      \n      // Clear any pending interim timeout\n      if (interimTimeoutRef.current) {\n        clearTimeout(interimTimeoutRef.current);\n        interimTimeoutRef.current = null;\n      }\n      \n      // Clear iOS silence timeout\n      if (iosSilenceTimeoutRef.current) {\n        clearTimeout(iosSilenceTimeoutRef.current);\n        iosSilenceTimeoutRef.current = null;\n      }\n      lastInterimTranscriptRef.current = \"\";\n      \n      // Clear starting flag when recognition ends\n      isStartingRef.current = false;\n      \n      // Update imperative ref for abort guards\n      isListeningRef.current = false;\n      setIsListening(false);\n    };\n\n    recognitionRef.current = recognition;\n\n    return () => {\n      // Clear any pending startup timeout\n      if (startupTimeoutRef.current) {\n        clearTimeout(startupTimeoutRef.current);\n        startupTimeoutRef.current = null;\n      }\n      \n      // Clear any pending interim timeout\n      if (interimTimeoutRef.current) {\n        clearTimeout(interimTimeoutRef.current);\n        interimTimeoutRef.current = null;\n      }\n      \n      // Clear iOS silence timeout\n      if (iosSilenceTimeoutRef.current) {\n        clearTimeout(iosSilenceTimeoutRef.current);\n        iosSilenceTimeoutRef.current = null;\n      }\n      \n      if (recognitionRef.current) {\n        console.log(\"[SpeechRecognition] Cleanup: aborting\");\n        recognitionRef.current.abort();\n      }\n    };\n  }, []);\n\n  const startListening = useCallback(() => {\n    const isMobile = isMobileDevice();\n    const isIOS = isIOSDevice();\n    \n    console.log(\"[SpeechRecognition] startListening called\", { \n      isListening, \n      isStarting: isStartingRef.current,\n      hasRecognition: !!recognitionRef.current,\n      isMobile,\n      isIOS\n    });\n    \n    // Clear any pending iOS silence timeout from previous session\n    if (iosSilenceTimeoutRef.current) {\n      clearTimeout(iosSilenceTimeoutRef.current);\n      iosSilenceTimeoutRef.current = null;\n    }\n    \n    // Guard: prevent starting if already listening or already starting\n    if (isListening || isStartingRef.current) {\n      console.warn(\"[SpeechRecognition] Already listening or starting, skipping start\");\n      return;\n    }\n    \n    if (!recognitionRef.current) {\n      console.error(\"[SpeechRecognition] Recognition not initialized\");\n      setError(\"Speech recognition not initialized\");\n      return;\n    }\n\n    // Set starting flag to prevent concurrent attempts\n    isStartingRef.current = true;\n\n    // CRITICAL: Abort any existing recognition session before starting new one\n    // Use imperative ref to check actual listening state (not stale closure)\n    try {\n      if (recognitionRef.current && isListeningRef.current) {\n        recognitionRef.current.abort();\n        console.log(\"[SpeechRecognition] Aborted existing active session before starting\");\n      }\n    } catch (abortErr) {\n      // Ignore abort errors - may not be running\n      console.warn(\"[SpeechRecognition] Error aborting existing session:\", abortErr);\n    }\n\n    // Helper function to start recognition after Bluetooth initialization\n    const doStartRecognition = () => {\n      try {\n        setTranscript(\"\");\n        setError(null);\n        console.log(\"[SpeechRecognition] Calling recognition.start()\");\n        \n        // Mobile devices need longer timeout due to permission dialogs and slower resource allocation\n        // iOS Safari permission prompts can take 4-5 seconds, so use 5s timeout for mobile\n        const timeout = isMobile ? 5000 : 2000;\n        \n        // Set timeout to detect if onstart never fires (microphone conflict)\n        startupTimeoutRef.current = setTimeout(() => {\n          console.error(`[SpeechRecognition] CRITICAL: onstart never fired after ${timeout}ms (microphone conflict)`);\n          \n          // CRITICAL FIX: Explicitly abort the recognition instance to release microphone\n          // Always abort on timeout since recognition.start() was called but onstart never fired\n          // This means the recognition is stuck in starting state and needs cleanup\n          try {\n            if (recognitionRef.current) {\n              recognitionRef.current.abort();\n              console.log(\"[SpeechRecognition] Aborted stuck recognition instance\");\n            }\n          } catch (abortErr) {\n            console.error(\"[SpeechRecognition] Error aborting recognition:\", abortErr);\n          }\n          \n          setError(\"Failed to start - microphone may still be in use\");\n          isListeningRef.current = false; // Update imperative ref\n          setIsListening(false);\n          isStartingRef.current = false; // Reset starting flag\n        }, timeout);\n        \n        recognitionRef.current.start();\n        // Note: setIsListening(true) is ONLY called in onstart event handler\n        // This ensures state reflects actual recognition status, not optimistic assumption\n      } catch (err: any) {\n        // Clear timeout on immediate error\n        if (startupTimeoutRef.current) {\n          clearTimeout(startupTimeoutRef.current);\n          startupTimeoutRef.current = null;\n        }\n        \n        isStartingRef.current = false; // Reset starting flag\n        \n        // Ignore \"already-started\" error but set listening state\n        if (err.message?.includes('already started')) {\n          console.warn(\"[SpeechRecognition] Already started error caught - setting isListening to true\");\n          setIsListening(true);\n          return;\n        }\n        console.error(\"[SpeechRecognition] Error starting recognition:\", err);\n        setError(\"Failed to start speech recognition\");\n      }\n    };\n\n    // Initialize Bluetooth/AirPods audio routing on mobile devices\n    // This \"primes\" the audio subsystem to use connected Bluetooth devices\n    if (isMobile) {\n      initializeBluetoothAudio()\n        .then(() => doStartRecognition())\n        .catch(() => doStartRecognition()); // Still try even if Bluetooth init fails\n    } else {\n      doStartRecognition();\n    }\n  }, [isListening]);\n\n  const stopListening = useCallback(() => {\n    console.log(\"[SpeechRecognition] stopListening called\", { \n      isListening, \n      hasRecognition: !!recognitionRef.current,\n      hasPendingInterimResults: !!lastInterimTranscriptRef.current\n    });\n    \n    // Clear any pending startup timeout\n    if (startupTimeoutRef.current) {\n      clearTimeout(startupTimeoutRef.current);\n      startupTimeoutRef.current = null;\n    }\n    \n    // Clear any pending interim timeout (but don't clear the interim transcript yet - let onend handle it)\n    if (interimTimeoutRef.current) {\n      clearTimeout(interimTimeoutRef.current);\n      interimTimeoutRef.current = null;\n    }\n    \n    // Clear iOS silence timeout\n    if (iosSilenceTimeoutRef.current) {\n      clearTimeout(iosSilenceTimeoutRef.current);\n      iosSilenceTimeoutRef.current = null;\n    }\n    \n    if (recognitionRef.current && isListening) {\n      console.log(\"[SpeechRecognition] Calling recognition.stop()\");\n      recognitionRef.current.stop();\n      // Note: lastInterimTranscriptRef will be processed and cleared in onend\n      isListeningRef.current = false; // Update imperative ref\n      setIsListening(false);\n    }\n  }, [isListening]);\n\n  const resetTranscript = useCallback(() => {\n    setTranscript(\"\");\n  }, []);\n\n  return {\n    transcript,\n    isListening,\n    error,\n    startListening,\n    stopListening,\n    resetTranscript,\n  };\n}\n","path":null,"size_bytes":18899,"size_tokens":null},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":2263,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1592,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1584,"size_tokens":null},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport Communicator from \"@/pages/Communicator\";\n\nfunction Router() {\n  return (\n    <Switch>\n      <Route path=\"/\" component={Communicator} />\n    </Switch>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <TooltipProvider>\n        <Toaster />\n        <Router />\n      </TooltipProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":644,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1139,"size_tokens":null},"server/storage.ts":{"content":"import { drizzle } from \"drizzle-orm/neon-serverless\";\nimport { Pool, neonConfig } from \"@neondatabase/serverless\";\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\nimport { eq, desc } from \"drizzle-orm\";\n\nneonConfig.webSocketConstructor = ws;\n\nconst pool = new Pool({ connectionString: process.env.DATABASE_URL! });\nexport const db = drizzle({ client: pool, schema });\n\nexport interface IStorage {\n  // Conversation operations\n  createConversation(): Promise<schema.Conversation>;\n  getConversation(id: string): Promise<schema.Conversation | undefined>;\n  \n  // Message operations\n  createMessage(message: schema.InsertMessage): Promise<schema.Message>;\n  getConversationMessages(conversationId: string): Promise<schema.Message[]>;\n  deleteConversation(id: string): Promise<void>;\n}\n\nexport class DbStorage implements IStorage {\n  async createConversation(): Promise<schema.Conversation> {\n    const [conversation] = await db\n      .insert(schema.conversations)\n      .values({})\n      .returning();\n    return conversation;\n  }\n\n  async getConversation(id: string): Promise<schema.Conversation | undefined> {\n    const [conversation] = await db\n      .select()\n      .from(schema.conversations)\n      .where(eq(schema.conversations.id, id))\n      .limit(1);\n    return conversation;\n  }\n\n  async createMessage(message: schema.InsertMessage): Promise<schema.Message> {\n    const [newMessage] = await db\n      .insert(schema.messages)\n      .values(message)\n      .returning();\n    return newMessage;\n  }\n\n  async getConversationMessages(conversationId: string): Promise<schema.Message[]> {\n    return await db\n      .select()\n      .from(schema.messages)\n      .where(eq(schema.messages.conversationId, conversationId))\n      .orderBy(schema.messages.timestamp);\n  }\n\n  async deleteConversation(id: string): Promise<void> {\n    await db\n      .delete(schema.conversations)\n      .where(eq(schema.conversations.id, id));\n  }\n}\n\nexport const storage = new DbStorage();\n","path":null,"size_bytes":1982,"size_tokens":null},"client/src/components/VoiceControlPanel.tsx":{"content":"import { Mic, MicOff, Volume2, AlertCircle } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { VoiceState } from \"@shared/schema\";\n\ninterface VoiceControlPanelProps {\n  voiceState: VoiceState;\n  onStartListening: () => void;\n  onStopListening: () => void;\n  onToggleContinuousMode?: () => void;\n  isContinuousModeActive?: boolean;\n  audioLevel?: number;\n  permissionState?: 'unknown' | 'checking' | 'granted' | 'denied' | 'error';\n  continuousModeAvailable?: boolean;\n}\n\n// Detect if user is on a mobile device\nconst isMobileDevice = (): boolean => {\n  return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\n};\n\nexport function VoiceControlPanel({\n  voiceState,\n  onStartListening,\n  onStopListening,\n  onToggleContinuousMode,\n  isContinuousModeActive = false,\n  audioLevel = 0,\n  permissionState = 'unknown',\n  continuousModeAvailable = true,\n}: VoiceControlPanelProps) {\n  const isListening = voiceState === \"listening\";\n  const isProcessing = voiceState === \"processing\";\n  const isSpeaking = voiceState === \"speaking\";\n  const isActive = isListening || isProcessing || isSpeaking || isContinuousModeActive;\n  const isPermissionDenied = permissionState === 'denied';\n  const isCheckingPermission = permissionState === 'checking';\n\n  const getStatusLabel = () => {\n    if (isCheckingPermission) {\n      return \"REQUESTING ACCESS\";\n    }\n    if (isPermissionDenied) {\n      return \"ACCESS DENIED\";\n    }\n    switch (voiceState) {\n      case \"listening\":\n        return \"LISTENING\";\n      case \"processing\":\n        return \"PROCESSING\";\n      case \"speaking\":\n        return \"SPEAKING\";\n      default:\n        return \"READY\";\n    }\n  };\n\n  const getStatusColor = () => {\n    if (isCheckingPermission) {\n      return \"text-chart-5\";\n    }\n    if (isPermissionDenied) {\n      return \"text-destructive\";\n    }\n    switch (voiceState) {\n      case \"listening\":\n        return \"text-chart-4\";\n      case \"processing\":\n        return \"text-chart-5\";\n      case \"speaking\":\n        return \"text-chart-2\";\n      default:\n        return \"text-primary\";\n    }\n  };\n\n  return (\n    <div className=\"flex flex-col items-center gap-6 p-8\">\n      {/* Status Label */}\n      <div className={`text-sm font-medium tracking-widest uppercase ${getStatusColor()}`}>\n        {getStatusLabel()}\n      </div>\n\n      {/* Voice Control Button */}\n      <div className=\"relative\">\n        <Button\n          data-testid=\"button-voice-control\"\n          size=\"icon\"\n          variant={isActive ? \"default\" : \"outline\"}\n          className={`h-32 w-32 rounded-full transition-all ${\n            isListening ? \"animate-pulse bg-chart-4 border-chart-4\" : \"\"\n          } ${isProcessing ? \"bg-chart-5 border-chart-5\" : \"\"} ${\n            isSpeaking ? \"bg-chart-2 border-chart-2\" : \"\"\n          } ${isCheckingPermission ? \"bg-chart-5 border-chart-5 animate-pulse\" : \"\"} ${\n            isPermissionDenied ? \"bg-destructive border-destructive\" : \"\"\n          } ${isContinuousModeActive && !isListening && !isProcessing && !isSpeaking && !isCheckingPermission ? \"ring-4 ring-chart-4 ring-offset-2\" : \"\"}`}\n          onClick={\n            continuousModeAvailable && onToggleContinuousMode\n              ? onToggleContinuousMode\n              : isListening\n              ? onStopListening\n              : onStartListening\n          }\n          disabled={isProcessing || isSpeaking || isCheckingPermission || isPermissionDenied}\n        >\n          {isCheckingPermission ? (\n            <Mic className=\"h-16 w-16 opacity-50\" />\n          ) : isPermissionDenied ? (\n            <AlertCircle className=\"h-16 w-16\" />\n          ) : isListening ? (\n            <MicOff className=\"h-16 w-16\" />\n          ) : isSpeaking ? (\n            <Volume2 className=\"h-16 w-16\" />\n          ) : (\n            <Mic className=\"h-16 w-16\" />\n          )}\n        </Button>\n\n        {/* Audio Level Visualization */}\n        {isListening && (\n          <div className=\"absolute inset-0 -z-10 flex items-center justify-center\">\n            <div\n              className=\"rounded-full bg-chart-4/20 transition-all duration-100\"\n              style={{\n                width: `${132 + audioLevel * 40}px`,\n                height: `${132 + audioLevel * 40}px`,\n              }}\n            />\n          </div>\n        )}\n      </div>\n\n      {/* Audio Waveform Visualization */}\n      {isListening && (\n        <div className=\"flex items-center justify-center gap-1 h-12\" data-testid=\"waveform-visualization\">\n          {Array.from({ length: 20 }).map((_, i) => (\n            <div\n              key={i}\n              className=\"w-1 bg-chart-2 rounded-full transition-all duration-100\"\n              style={{\n                height: `${8 + Math.random() * audioLevel * 32}px`,\n                opacity: 0.6 + Math.random() * 0.4,\n              }}\n            />\n          ))}\n        </div>\n      )}\n\n      {/* Processing Indicator */}\n      {isProcessing && (\n        <div className=\"relative w-64 h-1 bg-secondary overflow-hidden rounded-full\" data-testid=\"processing-indicator\">\n          <div className=\"absolute inset-y-0 left-0 w-1/3 bg-chart-5 animate-scan-horizontal\" />\n        </div>\n      )}\n\n      {/* Instructions */}\n      <p className=\"text-sm text-muted-foreground text-center max-w-sm\">\n        {isCheckingPermission\n          ? \"Requesting microphone access...\"\n          : isPermissionDenied\n          ? \"Microphone access denied. Check browser settings and refresh page.\"\n          : isListening\n          ? \"Speak your query to the Enterprise Computer\"\n          : isProcessing\n          ? \"Computer is processing your request\"\n          : isSpeaking\n          ? \"Computer is responding\"\n          : isContinuousModeActive\n          ? \"Continuous mode active - Tap to stop\"\n          : continuousModeAvailable\n          ? \"Tap to activate continuous voice mode\"\n          : \"Tap the button above to speak\"}\n      </p>\n      \n      {/* Mobile hint - shown on mobile devices when idle */}\n      {isMobileDevice() && !isListening && !isProcessing && !isSpeaking && !isCheckingPermission && !isPermissionDenied && (\n        <p className=\"text-xs text-muted-foreground/70 text-center max-w-xs mt-2\" data-testid=\"text-mobile-hint\">\n          On mobile devices, use this on-screen button to activate voice input\n        </p>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":6369,"size_tokens":null},"client/src/components/LCARSHeader.tsx":{"content":"import { Info, Mic } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Label } from \"@/components/ui/label\";\n\ninterface LCARSHeaderProps {\n  onClearConversation?: () => void;\n  isHandsFreeMode?: boolean;\n  onHandsFreeModeChange?: (enabled: boolean) => void;\n  voiceSettingsButton?: React.ReactNode;\n}\n\nexport function LCARSHeader({ onClearConversation, isHandsFreeMode = false, onHandsFreeModeChange, voiceSettingsButton }: LCARSHeaderProps) {\n  return (\n    <header className=\"relative border-b border-border bg-card\">\n      {/* LCARS decorative bars */}\n      <div className=\"absolute top-0 left-0 right-0 h-2 bg-primary\" />\n      \n      <div className=\"flex items-center justify-between p-4\">\n        {/* Left section with title */}\n        <div className=\"flex items-center gap-4\">\n          <div className=\"hidden sm:block w-2 h-12 bg-primary rounded-r-full\" />\n          <div>\n            <h1 className=\"text-lg sm:text-xl font-bold tracking-wider uppercase text-primary\">\n              USS ENTERPRISE\n            </h1>\n            <p className=\"text-xs text-muted-foreground tracking-widest uppercase\">\n              Computer Interface\n            </p>\n          </div>\n        </div>\n\n        {/* Right section with controls */}\n        <div className=\"flex items-center gap-2\">\n          {onClearConversation && (\n            <Button\n              data-testid=\"button-clear-conversation\"\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={onClearConversation}\n              className=\"uppercase tracking-wider text-xs\"\n            >\n              Clear\n            </Button>\n          )}\n\n          {voiceSettingsButton}\n\n          <Dialog>\n            <DialogTrigger asChild>\n              <Button\n                data-testid=\"button-info\"\n                variant=\"ghost\"\n                size=\"icon\"\n              >\n                <Info className=\"h-5 w-5\" />\n              </Button>\n            </DialogTrigger>\n            <DialogContent>\n              <DialogHeader>\n                <DialogTitle>Enterprise Computer Interface</DialogTitle>\n                <DialogDescription className=\"space-y-4 pt-4\">\n                  <p>\n                    Welcome to the USS Enterprise Computer voice interface. This system\n                    uses advanced AI to simulate the iconic Star Trek computer experience.\n                  </p>\n                  <div className=\"space-y-2\">\n                    <h4 className=\"font-semibold text-foreground\">How to Use:</h4>\n                    <ul className=\"list-disc list-inside space-y-1 text-sm\">\n                      <li>Tap the communicator button to start voice input</li>\n                      <li>Speak your query clearly</li>\n                      <li>The computer will process and respond with voice output</li>\n                      <li>Continue the conversation naturally</li>\n                    </ul>\n                  </div>\n                  <div className=\"space-y-2\">\n                    <h4 className=\"font-semibold text-foreground\">Mobile Devices:</h4>\n                    <p className=\"text-sm\">\n                      On iPhone and Android, tap the on-screen microphone button each time you want to speak. \n                      Bluetooth headset buttons (like AirPods) cannot control this web app due to browser limitations.\n                    </p>\n                  </div>\n                  <div className=\"space-y-2\">\n                    <h4 className=\"font-semibold text-foreground\">Status Indicators:</h4>\n                    <ul className=\"list-disc list-inside space-y-1 text-sm\">\n                      <li className=\"text-chart-4\">Green: Listening to your voice</li>\n                      <li className=\"text-chart-5\">Yellow: Processing your request</li>\n                      <li className=\"text-chart-2\">Blue: Computer speaking</li>\n                    </ul>\n                  </div>\n                </DialogDescription>\n              </DialogHeader>\n            </DialogContent>\n          </Dialog>\n\n          <div className=\"hidden sm:block w-2 h-12 bg-chart-2 rounded-l-full\" />\n        </div>\n      </div>\n\n      {/* Bottom decorative bar */}\n      <div className=\"absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-primary via-chart-2 to-chart-3\" />\n    </header>\n  );\n}\n","path":null,"size_bytes":4508,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":710,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1883,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4120,"size_tokens":null},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","path":null,"size_bytes":1280,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"client/src/components/VoiceSettings.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Settings, Volume2, Gauge, Zap } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { Label } from \"@/components/ui/label\";\nimport { Slider } from \"@/components/ui/slider\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { VoiceSettings } from \"@/hooks/useSpeechSynthesis\";\n\n// Re-export for convenience\nexport type { VoiceSettings };\n\n// Same priority list as useSpeechSynthesis.ts for consistency\nconst PREFERRED_VOICE_NAMES = [\n  // iOS/macOS - these are the most common female voices on Apple devices\n  \"samantha\", \"ava\", \"allison\", \"susan\", \"kate\", \"serena\", \"emily\",\n  \"siri female\", \"siri_female\",\n  // Windows\n  \"zira\", \"hazel\",\n  // Google Chrome voices\n  \"google uk english female\", \"google us english female\",\n  // Other female voices across platforms\n  \"female\", \"victoria\", \"karen\", \"moira\", \"fiona\", \"tessa\", \"veena\",\n];\n\n// Male voices to explicitly exclude (these should never be selected)\nconst MALE_VOICE_NAMES = [\n  \"aaron\", \"daniel\", \"fred\", \"alex\", \"tom\", \"oliver\", \"gordon\",\n  \"lee\", \"rishi\", \"david\", \"mark\", \"james\", \"george\",\n  \"google uk english male\", \"google us english male\", \"male\",\n];\n\n// Check if a voice is male\nfunction isMaleVoice(voice: SpeechSynthesisVoice): boolean {\n  const nameLower = voice.name.toLowerCase();\n  return MALE_VOICE_NAMES.some(maleName => nameLower.includes(maleName));\n}\n\nexport interface SoundSettings {\n  enabled: boolean;\n  volume: number;\n}\n\ninterface VoiceSettingsProps {\n  onSettingsChange?: (settings: VoiceSettings) => void;\n  onSoundSettingsChange?: (settings: SoundSettings) => void;\n}\n\nexport function VoiceSettingsPanel({ onSettingsChange, onSoundSettingsChange }: VoiceSettingsProps) {\n  const [voices, setVoices] = useState<SpeechSynthesisVoice[]>([]);\n  const [selectedVoiceIndex, setSelectedVoiceIndex] = useState(0);\n  const [selectedVoiceName, setSelectedVoiceName] = useState<string>(\"Loading...\");\n  const [voiceAvailable, setVoiceAvailable] = useState(true);\n  const [rate, setRate] = useState(0.9);  // Slightly slower for Star Trek computer style\n  const [pitch, setPitch] = useState(1.0);  // Natural pitch\n  const [volume, setVolume] = useState(1.0);\n  \n  // Sound effects settings\n  const [soundEnabled, setSoundEnabled] = useState(true);\n  const [soundVolume, setSoundVolume] = useState(0.4);\n\n  // Load saved settings from localStorage\n  useEffect(() => {\n    const savedVoice = localStorage.getItem(\"voiceSettings\");\n    if (savedVoice) {\n      try {\n        const settings = JSON.parse(savedVoice);\n        setRate(settings.rate ?? 0.9);  // Default to Star Trek computer pace\n        setPitch(settings.pitch ?? 1.0);\n        setVolume(settings.volume ?? 1.0);\n      } catch (e) {\n        console.error(\"Failed to load voice settings:\", e);\n      }\n    }\n    \n    const savedSound = localStorage.getItem(\"soundSettings\");\n    if (savedSound) {\n      try {\n        const settings = JSON.parse(savedSound);\n        setSoundEnabled(settings.enabled ?? true);\n        setSoundVolume(settings.volume ?? 0.4);\n      } catch (e) {\n        console.error(\"Failed to load sound settings:\", e);\n      }\n    }\n  }, []);\n\n  // Load voices and select best Star Trek computer-like female voice\n  useEffect(() => {\n    const loadVoices = () => {\n      const availableVoices = window.speechSynthesis.getVoices();\n      setVoices(availableVoices);\n      \n      // Log all voices for debugging (especially useful on iOS)\n      console.log(\"[VoiceSettings] All voices:\", availableVoices.map(v => `${v.name} (${v.lang})`).join(\", \"));\n      \n      // Filter to English voices\n      const englishVoices = availableVoices.filter(v => v.lang.startsWith(\"en\"));\n      \n      // Filter OUT male voices\n      const femaleEnglishVoices = englishVoices.filter(v => !isMaleVoice(v));\n      console.log(\"[VoiceSettings] Female English voices:\", femaleEnglishVoices.map(v => v.name).join(\", \"));\n      \n      const voicesToSearch = femaleEnglishVoices.length > 0 ? femaleEnglishVoices : englishVoices;\n      \n      // Search for preferred voices in priority order (same as useSpeechSynthesis.ts)\n      let foundVoice: SpeechSynthesisVoice | null = null;\n      let foundIndex = -1;\n      \n      for (const preferredName of PREFERRED_VOICE_NAMES) {\n        const matchedVoice = voicesToSearch.find(\n          voice => voice.name.toLowerCase().includes(preferredName)\n        );\n        if (matchedVoice) {\n          foundVoice = matchedVoice;\n          foundIndex = availableVoices.indexOf(matchedVoice);\n          console.log(\"[VoiceSettings] Selected voice:\", matchedVoice.name, `(matched: \"${preferredName}\")`);\n          break;\n        }\n      }\n      \n      if (foundVoice && foundIndex !== -1) {\n        setSelectedVoiceIndex(foundIndex);\n        setSelectedVoiceName(foundVoice.name);\n        setVoiceAvailable(true);\n      } else if (femaleEnglishVoices.length > 0) {\n        // Fallback to first female English voice\n        const fallback = femaleEnglishVoices[0];\n        setSelectedVoiceIndex(availableVoices.indexOf(fallback));\n        setSelectedVoiceName(fallback.name);\n        setVoiceAvailable(true);\n        console.log(\"[VoiceSettings] Using first female English voice:\", fallback.name);\n      } else if (englishVoices.length > 0) {\n        // Last resort: any English voice\n        const fallback = englishVoices[0];\n        setSelectedVoiceIndex(availableVoices.indexOf(fallback));\n        setSelectedVoiceName(fallback.name);\n        setVoiceAvailable(true);\n        console.warn(\"[VoiceSettings] No female voice found, using English voice:\", fallback.name);\n      } else {\n        setVoiceAvailable(false);\n        setSelectedVoiceName(\"No voice available\");\n        console.warn(\"[VoiceSettings] No voices available on this system\");\n      }\n    };\n\n    loadVoices();\n    window.speechSynthesis.onvoiceschanged = loadVoices;\n\n    return () => {\n      window.speechSynthesis.onvoiceschanged = null;\n    };\n  }, []);\n\n  useEffect(() => {\n    // Only emit settings when voice is available\n    if (!voiceAvailable) {\n      return;\n    }\n    \n    const settings = {\n      voiceIndex: selectedVoiceIndex,\n      rate,\n      pitch,\n      volume,\n    };\n    \n    // Save to localStorage\n    localStorage.setItem(\"voiceSettings\", JSON.stringify(settings));\n    \n    // Notify parent\n    onSettingsChange?.(settings);\n  }, [selectedVoiceIndex, rate, pitch, volume, onSettingsChange, voiceAvailable]);\n\n  useEffect(() => {\n    const settings = {\n      enabled: soundEnabled,\n      volume: soundVolume,\n    };\n    \n    // Save to localStorage\n    localStorage.setItem(\"soundSettings\", JSON.stringify(settings));\n    \n    // Notify parent\n    onSoundSettingsChange?.(settings);\n  }, [soundEnabled, soundVolume, onSoundSettingsChange]);\n\n  const handlePreview = () => {\n    if (!voiceAvailable) {\n      console.error(\"Cannot preview: No voice available\");\n      return;\n    }\n    \n    const utterance = new SpeechSynthesisUtterance(\n      \"Computer systems are online and operational.\"\n    );\n    if (voices[selectedVoiceIndex]) {\n      utterance.voice = voices[selectedVoiceIndex];\n    }\n    utterance.rate = rate;\n    utterance.pitch = pitch;\n    utterance.volume = volume;\n    \n    window.speechSynthesis.cancel();\n    window.speechSynthesis.speak(utterance);\n  };\n\n  return (\n    <Dialog>\n      <DialogTrigger asChild>\n        <Button\n          data-testid=\"button-voice-settings\"\n          variant=\"ghost\"\n          size=\"icon\"\n        >\n          <Settings className=\"h-5 w-5\" />\n        </Button>\n      </DialogTrigger>\n      <DialogContent className=\"max-w-md\">\n        <DialogHeader>\n          <DialogTitle>Voice Settings</DialogTitle>\n          <DialogDescription>\n            Customize the Enterprise Computer voice output\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"space-y-6 py-4\">\n          {/* Voice Display (Read-only) */}\n          <div className=\"space-y-2\">\n            <Label>Voice</Label>\n            <div \n              className={`flex h-9 w-full rounded-md border px-3 py-2 text-sm ${\n                voiceAvailable \n                  ? \"border-input bg-muted\" \n                  : \"border-destructive bg-destructive/10 text-destructive\"\n              }`}\n              data-testid=\"text-voice-name\"\n            >\n              {voiceAvailable && voices[selectedVoiceIndex]\n                ? `${voices[selectedVoiceIndex].name} (${voices[selectedVoiceIndex].lang})`\n                : selectedVoiceName}\n            </div>\n          </div>\n\n          {/* Speech Rate */}\n          <div className=\"space-y-2\">\n            <div className=\"flex items-center justify-between\">\n              <Label htmlFor=\"rate-slider\" className=\"flex items-center gap-2\">\n                <Gauge className=\"h-4 w-4\" />\n                Speed\n              </Label>\n              <span className=\"text-sm text-muted-foreground\">{rate.toFixed(2)}x</span>\n            </div>\n            <Slider\n              id=\"rate-slider\"\n              data-testid=\"slider-rate\"\n              min={0.5}\n              max={2.0}\n              step={0.05}\n              value={[rate]}\n              onValueChange={([value]) => setRate(value)}\n            />\n          </div>\n\n          {/* Pitch */}\n          <div className=\"space-y-2\">\n            <div className=\"flex items-center justify-between\">\n              <Label htmlFor=\"pitch-slider\">Pitch</Label>\n              <span className=\"text-sm text-muted-foreground\">{pitch.toFixed(2)}</span>\n            </div>\n            <Slider\n              id=\"pitch-slider\"\n              data-testid=\"slider-pitch\"\n              min={0.5}\n              max={2.0}\n              step={0.1}\n              value={[pitch]}\n              onValueChange={([value]) => setPitch(value)}\n            />\n          </div>\n\n          {/* Volume */}\n          <div className=\"space-y-2\">\n            <div className=\"flex items-center justify-between\">\n              <Label htmlFor=\"volume-slider\" className=\"flex items-center gap-2\">\n                <Volume2 className=\"h-4 w-4\" />\n                Volume\n              </Label>\n              <span className=\"text-sm text-muted-foreground\">{Math.round(volume * 100)}%</span>\n            </div>\n            <Slider\n              id=\"volume-slider\"\n              data-testid=\"slider-volume\"\n              min={0}\n              max={1}\n              step={0.1}\n              value={[volume]}\n              onValueChange={([value]) => setVolume(value)}\n            />\n          </div>\n\n          {/* Sound Effects Section */}\n          <div className=\"border-t pt-6 space-y-4\">\n            <h4 className=\"text-sm font-semibold\">Star Trek Sound Effects</h4>\n            \n            <div className=\"flex items-center justify-between\">\n              <Label htmlFor=\"sound-effects-toggle\" className=\"flex items-center gap-2 cursor-pointer\">\n                <Zap className=\"h-4 w-4\" />\n                Enable Sound Effects\n              </Label>\n              <Switch\n                id=\"sound-effects-toggle\"\n                data-testid=\"toggle-sound-effects\"\n                checked={soundEnabled}\n                onCheckedChange={setSoundEnabled}\n              />\n            </div>\n\n            {soundEnabled && (\n              <div className=\"space-y-2\">\n                <div className=\"flex items-center justify-between\">\n                  <Label htmlFor=\"sound-volume-slider\" className=\"flex items-center gap-2\">\n                    <Volume2 className=\"h-4 w-4\" />\n                    Effects Volume\n                  </Label>\n                  <span className=\"text-sm text-muted-foreground\">{Math.round(soundVolume * 100)}%</span>\n                </div>\n                <Slider\n                  id=\"sound-volume-slider\"\n                  data-testid=\"slider-sound-volume\"\n                  min={0}\n                  max={1}\n                  step={0.1}\n                  value={[soundVolume]}\n                  onValueChange={([value]) => setSoundVolume(value)}\n                  disabled={!soundEnabled}\n                />\n              </div>\n            )}\n          </div>\n\n          {/* Preview Button */}\n          <Button\n            data-testid=\"button-preview-voice\"\n            onClick={handlePreview}\n            className=\"w-full\"\n            variant=\"outline\"\n            disabled={!voiceAvailable}\n          >\n            {voiceAvailable ? \"Preview Voice\" : \"Voice Not Available\"}\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":12663,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","path":null,"size_bytes":166,"size_tokens":null},"public/sounds/SOUNDS_README.md":{"content":"# Star Trek Sound Effects\n\nTo enable authentic Star Trek LCARS computer sounds, place audio files in this directory with the following names:\n\n## Required Sound Files\n\n1. **activate.mp3** - Played when activating voice input (communicator button press)\n2. **listening.mp3** - Played when actively listening to user speech\n3. **processing.mp3** - Played while processing AI response\n4. **complete.mp3** - Played when computer finishes speaking response\n5. **error.mp3** - Played when an error occurs\n6. **button.mp3** - Generic button press sound (for UI interactions)\n\n## Where to Get Star Trek Sounds\n\n### Recommended Sources:\n- **TrekCore Audio Library**: https://www.trekcore.com/audio/\n- **MediaCollege TNG Sounds**: https://www.mediacollege.com/downloads/sound-effects/star-trek/tng/\n- **Star Trek Dimension**: https://www.stdimension.org/MediaLib/computere.htm\n\n### Suggested Sounds:\n- **Activate**: LCARS panel beep or chirp\n- **Listening**: Computer processing tone\n- **Processing**: Data processing sound\n- **Complete**: Affirmative beep or completion chime\n- **Error**: Alert or warning tone\n- **Button**: Generic LCARS button press\n\n## File Format\n- **Format**: MP3 (preferred) or WAV\n- **Quality**: 128kbps or higher\n- **Duration**: Keep sounds short (0.5-2 seconds)\n\n## Usage Note\nThe application will work without these sound files - they are optional enhancements. If files are not present, the app will continue to function normally without sound effects.\n\n## Copyright Notice\nStar Trek sounds are copyrighted by Paramount/CBS. These sounds should only be used for personal, non-commercial purposes in accordance with fair use guidelines.\n","path":null,"size_bytes":1655,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1056,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1209,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":844,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null}},"version":2}